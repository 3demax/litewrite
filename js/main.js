/*! matchMedia() polyfill - Test a CSS media type/query in JS. Authors & copyright (c) 2012: Scott Jehl, Paul Irish, Nicholas Zakas. Dual MIT/BSD license */

//     Underscore.js 1.3.3
//     (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Underscore is freely distributable under the MIT license.
//     Portions of Underscore are inspired or borrowed from Prototype,
//     Oliver Steele's Functional, and John Resig's Micro-Templating.
//     For all details and documentation:
//     http://documentcloud.github.com/underscore

//     (c) 2010-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

(function(){define("utils/log",{}),window.matchMedia=window.matchMedia||function(e,t){var n,r=e.documentElement,i=r.firstElementChild||r.firstChild,s=e.createElement("body"),o=e.createElement("div");return o.id="mq-test-1",o.style.cssText="position:absolute;top:-100em",s.style.background="none",s.appendChild(o),function(e){return o.innerHTML='&shy;<style media="'+e+'"> #mq-test-1 { width: 42px; }</style>',r.insertBefore(s,i),n=o.offsetWidth===42,r.removeChild(s),{matches:n,media:e}}}(document),define("libs/matchMedia",[],function(){}),function(){function C(e,t,n){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e._chain&&(e=e._wrapped),t._chain&&(t=t._wrapped);if(e.isEqual&&S.isFunction(e.isEqual))return e.isEqual(t);if(t.isEqual&&S.isFunction(t.isEqual))return t.isEqual(e);var r=a.call(e);if(r!=a.call(t))return!1;switch(r){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var i=n.length;while(i--)if(n[i]==e)return!0;n.push(e);var s=0,o=!0;if(r=="[object Array]"){s=e.length,o=s==t.length;if(o)while(s--)if(!(o=s in e==s in t&&C(e[s],t[s],n)))break}else{if("constructor"in e!="constructor"in t||e.constructor!=t.constructor)return!1;for(var u in e)if(S.has(e,u)){s++;if(!(o=S.has(t,u)&&C(e[u],t[u],n)))break}if(o){for(u in t)if(S.has(t,u)&&!(s--))break;o=!s}}return n.pop(),o}var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.slice,u=r.unshift,a=i.toString,f=i.hasOwnProperty,l=r.forEach,c=r.map,h=r.reduce,p=r.reduceRight,d=r.filter,v=r.every,m=r.some,g=r.indexOf,y=r.lastIndexOf,b=Array.isArray,w=Object.keys,E=s.bind,S=function(e){return new P(e)};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=S),exports._=S):e._=S,S.VERSION="1.3.3";var x=S.each=S.forEach=function(e,t,r){if(e==null)return;if(l&&e.forEach===l)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(i in e&&t.call(r,e[i],i,e)===n)return}else for(var o in e)if(S.has(e,o)&&t.call(r,e[o],o,e)===n)return};S.map=S.collect=function(e,t,n){var r=[];return e==null?r:c&&e.map===c?e.map(t,n):(x(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),e.length===+e.length&&(r.length=e.length),r)},S.reduce=S.foldl=S.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(h&&e.reduce===h)return r&&(t=S.bind(t,r)),i?e.reduce(t,n):e.reduce(t);x(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},S.reduceRight=S.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduceRight===p)return r&&(t=S.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=S.toArray(e).reverse();return r&&!i&&(t=S.bind(t,r)),i?S.reduce(s,t,n,r):S.reduce(s,t)},S.find=S.detect=function(e,t,n){var r;return T(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},S.filter=S.select=function(e,t,n){var r=[];return e==null?r:d&&e.filter===d?e.filter(t,n):(x(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},S.reject=function(e,t,n){var r=[];return e==null?r:(x(e,function(e,i,s){t.call(n,e,i,s)||(r[r.length]=e)}),r)},S.every=S.all=function(e,t,r){var i=!0;return e==null?i:v&&e.every===v?e.every(t,r):(x(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var T=S.some=S.any=function(e,t,r){t||(t=S.identity);var i=!1;return e==null?i:m&&e.some===m?e.some(t,r):(x(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};S.include=S.contains=function(e,t){var n=!1;return e==null?n:g&&e.indexOf===g?e.indexOf(t)!=-1:(n=T(e,function(e){return e===t}),n)},S.invoke=function(e,t){var n=o.call(arguments,2);return S.map(e,function(e){return(S.isFunction(t)?t||e:e[t]).apply(e,n)})},S.pluck=function(e,t){return S.map(e,function(e){return e[t]})},S.max=function(e,t,n){if(!t&&S.isArray(e)&&e[0]===+e[0])return Math.max.apply(Math,e);if(!t&&S.isEmpty(e))return-Infinity;var r={computed:-Infinity};return x(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},S.min=function(e,t,n){if(!t&&S.isArray(e)&&e[0]===+e[0])return Math.min.apply(Math,e);if(!t&&S.isEmpty(e))return Infinity;var r={computed:Infinity};return x(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},S.shuffle=function(e){var t=[],n;return x(e,function(e,r,i){n=Math.floor(Math.random()*(r+1)),t[r]=t[n],t[n]=e}),t},S.sortBy=function(e,t,n){var r=S.isFunction(t)?t:function(e){return e[t]};return S.pluck(S.map(e,function(e,t,i){return{value:e,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;return n===void 0?1:r===void 0?-1:n<r?-1:n>r?1:0}),"value")},S.groupBy=function(e,t){var n={},r=S.isFunction(t)?t:function(e){return e[t]};return x(e,function(e,t){var i=r(e,t);(n[i]||(n[i]=[])).push(e)}),n},S.sortedIndex=function(e,t,n){n||(n=S.identity);var r=0,i=e.length;while(r<i){var s=r+i>>1;n(e[s])<n(t)?r=s+1:i=s}return r},S.toArray=function(e){return e?S.isArray(e)?o.call(e):S.isArguments(e)?o.call(e):e.toArray&&S.isFunction(e.toArray)?e.toArray():S.values(e):[]},S.size=function(e){return S.isArray(e)?e.length:S.keys(e).length},S.first=S.head=S.take=function(e,t,n){return t!=null&&!n?o.call(e,0,t):e[0]},S.initial=function(e,t,n){return o.call(e,0,e.length-(t==null||n?1:t))},S.last=function(e,t,n){return t!=null&&!n?o.call(e,Math.max(e.length-t,0)):e[e.length-1]},S.rest=S.tail=function(e,t,n){return o.call(e,t==null||n?1:t)},S.compact=function(e){return S.filter(e,function(e){return!!e})},S.flatten=function(e,t){return S.reduce(e,function(e,n){return S.isArray(n)?e.concat(t?n:S.flatten(n)):(e[e.length]=n,e)},[])},S.without=function(e){return S.difference(e,o.call(arguments,1))},S.uniq=S.unique=function(e,t,n){var r=n?S.map(e,n):e,i=[];return e.length<3&&(t=!0),S.reduce(r,function(n,r,s){if(t?S.last(n)!==r||!n.length:!S.include(n,r))n.push(r),i.push(e[s]);return n},[]),i},S.union=function(){return S.uniq(S.flatten(arguments,!0))},S.intersection=S.intersect=function(e){var t=o.call(arguments,1);return S.filter(S.uniq(e),function(e){return S.every(t,function(t){return S.indexOf(t,e)>=0})})},S.difference=function(e){var t=S.flatten(o.call(arguments,1),!0);return S.filter(e,function(e){return!S.include(t,e)})},S.zip=function(){var e=o.call(arguments),t=S.max(S.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=S.pluck(e,""+r);return n},S.indexOf=function(e,t,n){if(e==null)return-1;var r,i;if(n)return r=S.sortedIndex(e,t),e[r]===t?r:-1;if(g&&e.indexOf===g)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(r in e&&e[r]===t)return r;return-1},S.lastIndexOf=function(e,t){if(e==null)return-1;if(y&&e.lastIndexOf===y)return e.lastIndexOf(t);var n=e.length;while(n--)if(n in e&&e[n]===t)return n;return-1},S.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var N=function(){};S.bind=function(t,n){var r,i;if(t.bind===E&&E)return E.apply(t,o.call(arguments,1));if(!S.isFunction(t))throw new TypeError;return i=o.call(arguments,2),r=function(){if(this instanceof r){N.prototype=t.prototype;var e=new N,s=t.apply(e,i.concat(o.call(arguments)));return Object(s)===s?s:e}return t.apply(n,i.concat(o.call(arguments)))}},S.bindAll=function(e){var t=o.call(arguments,1);return t.length==0&&(t=S.functions(e)),x(t,function(t){e[t]=S.bind(e[t],e)}),e},S.memoize=function(e,t){var n={};return t||(t=S.identity),function(){var r=t.apply(this,arguments);return S.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},S.delay=function(e,t){var n=o.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},S.defer=function(e){return S.delay.apply(S,[e,1].concat(o.call(arguments,1)))},S.throttle=function(e,t){var n,r,i,s,o,u,a=S.debounce(function(){o=s=!1},t);return function(){n=this,r=arguments;var f=function(){i=null,o&&e.apply(n,r),a()};return i||(i=setTimeout(f,t)),s?o=!0:u=e.apply(n,r),a(),s=!0,u}},S.debounce=function(e,t,n){var r;return function(){var i=this,s=arguments,o=function(){r=null,n||e.apply(i,s)};n&&!r&&e.apply(i,s),clearTimeout(r),r=setTimeout(o,t)}},S.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments))}},S.wrap=function(e,t){return function(){var n=[e].concat(o.call(arguments,0));return t.apply(this,n)}},S.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},S.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},S.keys=w||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)S.has(e,n)&&(t[t.length]=n);return t},S.values=function(e){return S.map(e,S.identity)},S.functions=S.methods=function(e){var t=[];for(var n in e)S.isFunction(e[n])&&t.push(n);return t.sort()},S.extend=function(e){return x(o.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},S.pick=function(e){var t={};return x(S.flatten(o.call(arguments,1)),function(n){n in e&&(t[n]=e[n])}),t},S.defaults=function(e){return x(o.call(arguments,1),function(t){for(var n in t)e[n]==null&&(e[n]=t[n])}),e},S.clone=function(e){return S.isObject(e)?S.isArray(e)?e.slice():S.extend({},e):e},S.tap=function(e,t){return t(e),e},S.isEqual=function(e,t){return C(e,t,[])},S.isEmpty=function(e){if(e==null)return!0;if(S.isArray(e)||S.isString(e))return e.length===0;for(var t in e)if(S.has(e,t))return!1;return!0},S.isElement=function(e){return!!e&&e.nodeType==1},S.isArray=b||function(e){return a.call(e)=="[object Array]"},S.isObject=function(e){return e===Object(e)},S.isArguments=function(e){return a.call(e)=="[object Arguments]"},S.isArguments(arguments)||(S.isArguments=function(e){return!!e&&!!S.has(e,"callee")}),S.isFunction=function(e){return a.call(e)=="[object Function]"},S.isString=function(e){return a.call(e)=="[object String]"},S.isNumber=function(e){return a.call(e)=="[object Number]"},S.isFinite=function(e){return S.isNumber(e)&&isFinite(e)},S.isNaN=function(e){return e!==e},S.isBoolean=function(e){return e===!0||e===!1||a.call(e)=="[object Boolean]"},S.isDate=function(e){return a.call(e)=="[object Date]"},S.isRegExp=function(e){return a.call(e)=="[object RegExp]"},S.isNull=function(e){return e===null},S.isUndefined=function(e){return e===void 0},S.has=function(e,t){return f.call(e,t)},S.noConflict=function(){return e._=t,this},S.identity=function(e){return e},S.times=function(e,t,n){for(var r=0;r<e;r++)t.call(n,r)},S.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},S.result=function(e,t){if(e==null)return null;var n=e[t];return S.isFunction(n)?n.call(e):n},S.mixin=function(e){x(S.functions(e),function(t){B(t,S[t]=e[t])})};var k=0;S.uniqueId=function(e){var t=k++;return e?e+t:t},S.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/.^/,A={"\\":"\\","'":"'",r:"\r",n:"\n",t:"	",u2028:"\u2028",u2029:"\u2029"};for(var O in A)A[A[O]]=O;var M=/\\|'|\r|\n|\t|\u2028|\u2029/g,_=/\\(\\|'|r|n|t|u2028|u2029)/g,D=function(e){return e.replace(_,function(e,t){return A[t]})};S.template=function(e,t,n){n=S.defaults(n||{},S.templateSettings);var r="__p+='"+e.replace(M,function(e){return"\\"+A[e]}).replace(n.escape||L,function(e,t){return"'+\n_.escape("+D(t)+")+\n'"}).replace(n.interpolate||L,function(e,t){return"'+\n("+D(t)+")+\n'"}).replace(n.evaluate||L,function(e,t){return"';\n"+D(t)+"\n;__p+='"})+"';\n";n.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+r+"return __p;\n";var i=new Function(n.variable||"obj","_",r);if(t)return i(t,S);var s=function(e){return i.call(this,e,S)};return s.source="function("+(n.variable||"obj")+"){\n"+r+"}",s},S.chain=function(e){return S(e).chain()};var P=function(e){this._wrapped=e};S.prototype=P.prototype;var H=function(e,t){return t?S(e).chain():e},B=function(e,t){P.prototype[e]=function(){var e=o.call(arguments);return u.call(e,this._wrapped),H(t.apply(S,e),this._chain)}};S.mixin(S),x(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];P.prototype[e]=function(){var n=this._wrapped;t.apply(n,arguments);var r=n.length;return(e=="shift"||e=="splice")&&r===0&&delete n[0],H(n,this._chain)}}),x(["concat","join","slice"],function(e){var t=r[e];P.prototype[e]=function(){return H(t.apply(this._wrapped,arguments),this._chain)}}),P.prototype.chain=function(){return this._chain=!0,this},P.prototype.value=function(){return this._wrapped},typeof define=="function"&&define.amd&&define("underscore",[],function(){return S})}.call(this),function(e,t){typeof exports!="undefined"?t(e,exports,require("underscore")):typeof define=="function"&&define.amd?define("backbone",["underscore","jquery","exports"],function(n,r,i){e.Backbone=t(e,i,n,r)}):e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender)}(this,function(e,t,n,r){var i=e.Backbone,s=Array.prototype.slice,o=Array.prototype.splice;t.VERSION="0.9.2",t.setDomLibrary=function(e){r=e},t.noConflict=function(){return e.Backbone=i,t},t.emulateHTTP=!1,t.emulateJSON=!1;var u=/\s+/,a=t.Events={on:function(e,t,n){var r,i,s,o,a;if(!t)return this;e=e.split(u),r=this._callbacks||(this._callbacks={});while(i=e.shift())a=r[i],s=a?a.tail:{},s.next=o={},s.context=n,s.callback=t,r[i]={tail:o,next:a?a.next:s};return this},off:function(e,t,r){var i,s,o,a,f,l;if(!(s=this._callbacks))return;if(!(e||t||r))return delete this._callbacks,this;e=e?e.split(u):n.keys(s);while(i=e.shift()){o=s[i],delete s[i];if(!o||!t&&!r)continue;a=o.tail;while((o=o.next)!==a)f=o.callback,l=o.context,(t&&f!==t||r&&l!==r)&&this.on(i,f,l)}return this},trigger:function(e){var t,n,r,i,o,a,f;if(!(r=this._callbacks))return this;a=r.all,e=e.split(u),f=s.call(arguments,1);while(t=e.shift()){if(n=r[t]){i=n.tail;while((n=n.next)!==i)n.callback.apply(n.context||this,f)}if(n=a){i=n.tail,o=[t].concat(f);while((n=n.next)!==i)n.callback.apply(n.context||this,o)}}return this}};a.bind=a.on,a.unbind=a.off;var f=t.Model=function(e,t){var r;e||(e={}),t&&t.parse&&(e=this.parse(e));if(r=C(this,"defaults"))e=n.extend({},r,e);t&&t.collection&&(this.collection=t.collection),this.attributes={},this._escapedAttributes={},this.cid=n.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(e,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=n.clone(this.attributes),this.initialize.apply(this,arguments)};n.extend(f.prototype,a,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},get:function(e){return this.attributes[e]},escape:function(e){var t;if(t=this._escapedAttributes[e])return t;var r=this.get(e);return this._escapedAttributes[e]=n.escape(r==null?"":""+r)},has:function(e){return this.get(e)!=null},set:function(e,t,r){var i,s,o;n.isObject(e)||e==null?(i=e,r=t):(i={},i[e]=t),r||(r={});if(!i)return this;i instanceof f&&(i=i.attributes);if(r.unset)for(s in i)i[s]=void 0;if(!this._validate(i,r))return!1;this.idAttribute in i&&(this.id=i[this.idAttribute]);var u=r.changes={},a=this.attributes,l=this._escapedAttributes,c=this._previousAttributes||{};for(s in i){o=i[s];if(!n.isEqual(a[s],o)||r.unset&&n.has(a,s))delete l[s],(r.silent?this._silent:u)[s]=!0;r.unset?delete a[s]:a[s]=o,!n.isEqual(c[s],o)||n.has(a,s)!=n.has(c,s)?(this.changed[s]=o,r.silent||(this._pending[s]=!0)):(delete this.changed[s],delete this._pending[s])}return r.silent||this.change(r),this},unset:function(e,t){return(t||(t={})).unset=!0,this.set(e,null,t)},clear:function(e){return(e||(e={})).unset=!0,this.set(n.clone(this.attributes),e)},fetch:function(e){e=e?n.clone(e):{};var r=this,i=e.success;return e.success=function(t,n,s){if(!r.set(r.parse(t,s),e))return!1;i&&i(r,t)},e.error=t.wrapError(e.error,r,e),(this.sync||t.sync).call(this,"read",this,e)},save:function(e,r,i){var s,o;n.isObject(e)||e==null?(s=e,i=r):(s={},s[e]=r),i=i?n.clone(i):{};if(i.wait){if(!this._validate(s,i))return!1;o=n.clone(this.attributes)}var u=n.extend({},i,{silent:!0});if(s&&!this.set(s,i.wait?u:i))return!1;var a=this,f=i.success;i.success=function(e,t,r){var o=a.parse(e,r);i.wait&&(delete i.wait,o=n.extend(s||{},o));if(!a.set(o,i))return!1;f?f(a,e):a.trigger("sync",a,e,i)},i.error=t.wrapError(i.error,a,i);var l=this.isNew()?"create":"update",c=(this.sync||t.sync).call(this,l,this,i);return i.wait&&this.set(o,u),c},destroy:function(e){e=e?n.clone(e):{};var r=this,i=e.success,s=function(){r.trigger("destroy",r,r.collection,e)};if(this.isNew())return s(),!1;e.success=function(t){e.wait&&s(),i?i(r,t):r.trigger("sync",r,t,e)},e.error=t.wrapError(e.error,r,e);var o=(this.sync||t.sync).call(this,"delete",this,e);return e.wait||s(),o},url:function(){var e=C(this,"urlRoot")||C(this.collection,"url")||k();return this.isNew()?e:e+(e.charAt(e.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(e){e||(e={});var t=this._changing;this._changing=!0;for(var r in this._silent)this._pending[r]=!0;var i=n.extend({},e.changes,this._silent);this._silent={};for(var r in i)this.trigger("change:"+r,this,this.get(r),e);if(t)return this;while(!n.isEmpty(this._pending)){this._pending={},this.trigger("change",this,e);for(var r in this.changed){if(this._pending[r]||this._silent[r])continue;delete this.changed[r]}this._previousAttributes=n.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(e){return arguments.length?n.has(this.changed,e):!n.isEmpty(this.changed)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t,r=!1,i=this._previousAttributes;for(var s in e){if(n.isEqual(i[s],t=e[s]))continue;(r||(r={}))[s]=t}return r},previous:function(e){return!arguments.length||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return n.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(e,t){if(t.silent||!this.validate)return!0;e=n.extend({},this.attributes,e);var r=this.validate(e,t);return r?(t&&t.error?t.error(this,r,t):this.trigger("error",this,r,t),!1):!0}});var l=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,{silent:!0,parse:t.parse})};n.extend(l.prototype,a,{model:f,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},add:function(e,t){var r,i,s,u,a,f,l={},c={},h=[];t||(t={}),e=n.isArray(e)?e.slice():[e];for(r=0,s=e.length;r<s;r++){if(!(u=e[r]=this._prepareModel(e[r],t)))throw new Error("Can't add an invalid model to a collection");a=u.cid,f=u.id;if(l[a]||this._byCid[a]||f!=null&&(c[f]||this._byId[f])){h.push(r);continue}l[a]=c[f]=u}r=h.length;while(r--)e.splice(h[r],1);for(r=0,s=e.length;r<s;r++)(u=e[r]).on("all",this._onModelEvent,this),this._byCid[u.cid]=u,u.id!=null&&(this._byId[u.id]=u);this.length+=s,i=t.at!=null?t.at:this.models.length,o.apply(this.models,[i,0].concat(e)),this.comparator&&this.sort({silent:!0});if(t.silent)return this;for(r=0,s=this.models.length;r<s;r++){if(!l[(u=this.models[r]).cid])continue;t.index=r,u.trigger("add",u,this,t)}return this},remove:function(e,t){var r,i,s,o;t||(t={}),e=n.isArray(e)?e.slice():[e];for(r=0,i=e.length;r<i;r++){o=this.getByCid(e[r])||this.get(e[r]);if(!o)continue;delete this._byId[o.id],delete this._byCid[o.cid],s=this.indexOf(o),this.models.splice(s,1),this.length--,t.silent||(t.index=s,o.trigger("remove",o,this,t)),this._removeReference(o)}return this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,t),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,n.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},get:function(e){return e==null?void 0:this._byId[e.id!=null?e.id:e]},getByCid:function(e){return e&&this._byCid[e.cid||e]},at:function(e){return this.models[e]},where:function(e){return n.isEmpty(e)?[]:this.filter(function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},sort:function(e){e||(e={});if(!this.comparator)throw new Error("Cannot sort a set without a comparator");var t=n.bind(this.comparator,this);return this.comparator.length==1?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("reset",this,e),this},pluck:function(e){return n.map(this.models,function(t){return t.get(e)})},reset:function(e,t){e||(e=[]),t||(t={});for(var r=0,i=this.models.length;r<i;r++)this._removeReference(this.models[r]);return this._reset(),this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},fetch:function(e){e=e?n.clone(e):{},e.parse===undefined&&(e.parse=!0);var r=this,i=e.success;return e.success=function(t,n,s){r[e.add?"add":"reset"](r.parse(t,s),e),i&&i(r,t)},e.error=t.wrapError(e.error,r,e),(this.sync||t.sync).call(this,"read",this,e)},create:function(e,t){var r=this;t=t?n.clone(t):{},e=this._prepareModel(e,t);if(!e)return!1;t.wait||r.add(e,t);var i=t.success;return t.success=function(n,s,o){t.wait&&r.add(n,t),i?i(n,s):n.trigger("sync",e,s,t)},e.save(null,t),e},parse:function(e,t){return e},chain:function(){return n(this.models).chain()},_reset:function(e){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(e,t){t||(t={});if(e instanceof f)e.collection||(e.collection=this);else{var n=e;t.collection=this,e=new this.model(n,t),e._validate(e.attributes,t)||(e=!1)}return e},_removeReference:function(e){this==e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e=="add"||e=="remove")&&n!=this)return;e=="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],this._byId[t.id]=t),this.trigger.apply(this,arguments)}});var c=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];n.each(c,function(e){l.prototype[e]=function(){return n[e].apply(n,[this.models].concat(n.toArray(arguments)))}});var h=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},p=/:\w+/g,d=/\*\w+/g,v=/[-[\]{}()+?.,\\^$|#\s]/g;n.extend(h.prototype,a,{initialize:function(){},route:function(e,r,i){return t.history||(t.history=new m),n.isRegExp(e)||(e=this._routeToRegExp(e)),i||(i=this[r]),t.history.route(e,n.bind(function(n){var s=this._extractParameters(e,n);i&&i.apply(this,s),this.trigger.apply(this,["route:"+r].concat(s)),t.history.trigger("route",this,r,s)},this)),this},navigate:function(e,n){t.history.navigate(e,n)},_bindRoutes:function(){if(!this.routes)return;var e=[];for(var t in this.routes)e.unshift([t,this.routes[t]]);for(var n=0,r=e.length;n<r;n++)this.route(e[n][0],e[n][1],this[e[n][1]])},_routeToRegExp:function(e){return e=e.replace(v,"\\$&").replace(p,"([^/]+)").replace(d,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var m=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl")},g=/^[#\/]/,y=/msie [\w.]+/;m.started=!1,n.extend(m.prototype,a,{interval:50,getHash:function(e){var t=e?e.location:window.location,n=t.href.match(/#(.*)$/);return n?n[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||t){e=window.location.pathname;var n=window.location.search;n&&(e+=n)}else e=this.getHash();return e.indexOf(this.options.root)||(e=e.substr(this.options.root.length)),e.replace(g,"")},start:function(e){if(m.started)throw new Error("Backbone.history has already been started");m.started=!0,this.options=n.extend({},{root:"/"},this.options,e),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var t=this.getFragment(),i=document.documentMode,s=y.exec(navigator.userAgent.toLowerCase())&&(!i||i<=7);s&&(this.iframe=r('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?r(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?r(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var o=window.location,u=o.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!u)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&u&&o.hash&&(this.fragment=this.getHash().replace(g,""),window.history.replaceState({},document.title,o.protocol+"//"+o.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},stop:function(){r(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),m.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t==this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t==this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),r=n.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return r},navigate:function(e,t){if(!m.started)return!1;if(!t||t===!0)t={trigger:t};var n=(e||"").replace(g,"");if(this.fragment==n)return;this._hasPushState?(n.indexOf(this.options.root)!=0&&(n=this.options.root+n),this.fragment=n,window.history[t.replace?"replaceState":"pushState"]({},document.title,n)):this._wantsHashChange?(this.fragment=n,this._updateHash(window.location,n,t.replace),this.iframe&&n!=this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,n,t.replace))):window.location.assign(this.options.root+e),t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){n?e.replace(e.toString().replace(/(javascript:|#).*$/,"")+"#"+t):e.hash=t}});var b=t.View=function(e){this.cid=n.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},w=/^(\S+)\s*(.*)$/,E=["model","collection","el","id","attributes","className","tagName"];n.extend(b.prototype,a,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(e,t,n){var i=document.createElement(e);return t&&r(i).attr(t),n!=null&&r(i).html(n),i},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof r?e:r(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=C(this,"events")))return;this.undelegateEvents();for(var t in e){var r=e[t];n.isFunction(r)||(r=this[e[t]]);if(!r)throw new Error('Method "'+e[t]+'" does not exist');var i=t.match(w),s=i[1],o=i[2];r=n.bind(r,this),s+=".delegateEvents"+this.cid,o===""?this.$el.bind(s,r):this.$el.delegate(o,s,r)}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=n.extend({},this.options,e));for(var t=0,r=E.length;t<r;t++){var i=E[t];e[i]&&(this[i]=e[i])}this.options=e},_ensureElement:function(){if(!this.el){var e=C(this,"attributes")||{};this.id&&(e.id=this.id),this.className&&(e["class"]=this.className),this.setElement(this.make(this.tagName,e),!1)}else this.setElement(this.el,!1)}});var S=function(e,t){var n=N(this,e,t);return n.extend=this.extend,n};f.extend=l.extend=h.extend=b.extend=S;var x={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};t.sync=function(e,i,s){var o=x[e];s||(s={});var u={type:o,dataType:"json"};return s.url||(u.url=C(i,"url")||k()),!s.data&&i&&(e=="create"||e=="update")&&(u.contentType="application/json",u.data=JSON.stringify(i.toJSON())),t.emulateJSON&&(u.contentType="application/x-www-form-urlencoded",u.data=u.data?{model:u.data}:{}),t.emulateHTTP&&(o==="PUT"||o==="DELETE")&&(t.emulateJSON&&(u.data._method=o),u.type="POST",u.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",o)}),u.type!=="GET"&&!t.emulateJSON&&(u.processData=!1),r.ajax(n.extend(u,s))},t.wrapError=function(e,t,n){return function(r,i){i=r===t?i:r,e?e(t,i,n):t.trigger("error",t,i,n)}};var T=function(){},N=function(e,t,r){var i;return t&&t.hasOwnProperty("constructor")?i=t.constructor:i=function(){e.apply(this,arguments)},n.extend(i,e),T.prototype=e.prototype,i.prototype=new T,t&&n.extend(i.prototype,t),r&&n.extend(i,r),i.prototype.constructor=i,i.__super__=e.prototype,i},C=function(e,t){return!e||!e[t]?null:n.isFunction(e[t])?e[t]():e[t]},k=function(){throw new Error('A "url" property or function must be specified')};return t}),define("text",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),define("text!templates/entries.html",[],function(){return'<li id="add" class="add"><span class="add-plus">+ </span><span class="add-text">New document</span></li>\n<% _.each(docs, function(doc) { %>\n  <li class="item" data-id="<%= doc.id %>">\n    <a href="" style="color: <%= doc.color %>">\n      <%= doc.title %>\n    </a>\n  </li>\n<% }); %>\n'}),define("localstorage",["underscore","backbone"],function(e,t){function n(){return((1+Math.random())*65536|0).toString(16).substring(1)}function r(){return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}var i=function(e){this.name=e;var t=localStorage.getItem(this.name);this.data=t&&JSON.parse(t)||{}};return e.extend(i.prototype,{save:function(){localStorage.setItem(this.name,JSON.stringify(this.data))},create:function(e){return e.id||e.set(e.idAttribute,r()),this.data[e.id]=e,this.save(),e},update:function(e){return this.data[e.id]=e,this.save(),e},find:function(e){return this.data[e.id]},findAll:function(){return e.values(this.data)},destroy:function(e){return delete this.data[e.id],this.save(),e}}),t.sync=function(e,t,n){var r,i=t.localStorage||t.collection.localStorage;switch(e){case"read":r=t.id!==undefined?i.find(t):i.findAll();break;case"create":r=i.create(t);break;case"update":r=i.update(t);break;case"delete":r=i.destroy(t)}r?n.success(r):n.error("Record not found")},i}),define("remotestorage-documents",["require","remotestorage"],function(e){e("remotestorage");var t="documents";return remoteStorage.defineModule(t,function(e){function r(e,t){if(e=="error")for(var r=0;r<n.length;r++)n[r](t)}function i(){var e="",t,n;for(t=0;t<32;t++){n=Math.random()*16|0;if(t===8||t===12||t===16||t===20)e+="-";e+=(t===12?4:t===16?n&3|8:n).toString(16)}return e}function s(t){function r(){return e.getListing(t+"/")}function s(n){var r=e.getObject(t+"/"+n);return r?r.content:""}function o(e){return s(e).slice(0,50)}function u(n,r){r===""?e.remove(t+"/"+n):e.storeObject("text",t+"/"+n,{content:r})}function a(n){var r=i();return e.storeObject("text",t+"/"+r,{content:n}),r}function f(t,r){e.on(t,r),t=="error"&&n.push(r)}function l(n,r){e.storeObject("text",t+"/"+n,r)}function c(n){var r=e.getObject(t+"/"+n);return r?r:{}}return e.use(t+"/"),{getIds:r,getContent:s,getTitle:o,setContent:u,set:l,get:c,add:a,on:f}}var n=[];return{name:t,dataHints:{module:"documents can be text documents, or etherpad-lite documents or pdfs or whatever people consider a (text) document. But spreadsheets and diagrams probably not","objectType text":"a human-readable plain-text document in utf-8. No html or markdown etc, they should have their own object types","string text#content":"the content of the text document","directory documents/notes/":"used by litewrite for quick notes","item documents/notes/calendar":"used by docrastinate for the 'calendar' pane","item documents/notes/projects":"used by docrastinate for the 'projects' pane","item documents/notes/personal":"used by docrastinate for the 'personal' pane"},exports:{getPrivateList:s,onChange:function(t,n){e.on("change",function(e){var r=e.relativePath.match(new RegExp("^"+t+"/(.+)$"));r&&(e.id=r[1],n(e))})}}}}),remoteStorage[t]}),define("utils/backbone.remoteStorage-documents",["require","remotestorage-documents"],function(e){function r(e,t,n){var r;switch(e){case"read":r=t.id!==undefined?i(t):s();break;case"create":r=o(t);break;case"update":r=u(t);break;case"delete":r=a(t)}r?n.success(r):n.error("Record not found")}function i(e){return n.get(e.id)}function s(){var e=n.getIds(),t=[];for(var r=e.length-1;r>=0;r--)t.push(n.get(e[r]));return t}function o(e){return e.set(e.idAttribute,n.add(e.attributes)),e}function u(e){return n.set(e.id,e.attributes),e}function a(e){return n.setContent(e.id,""),e}var t=e("remotestorage-documents");remoteStorage.claimAccess("documents","rw");var n=t.getPrivateList("notes");return r}),define("models/doc",["require","backbone","utils/backbone.remoteStorage-documents"],function(e){var t=e("backbone"),n=e("utils/backbone.remoteStorage-documents");return Doc=t.Model.extend({defaults:{title:"",url:"",content:"",lastEdited:undefined},sync:n,initialize:function(){this.on("change:content",this.updateLastEdited).on("change:content",this.updateTitle)},isEmpty:function(){return this.get("content").match(/^(<\/{0,1}div>|<br>|\s|&nbsp;)*?$/)!==null},updateLastEdited:function(){this.set("lastEdited",(new Date).getTime())},updateTitle:function(){var e=this.get("content").match(/^(<div>|<\/div>|<br>|\s|&nbsp;)*(.*?)(<div>|<\/div>|<br>|$)/)[2].replace(/&nbsp;/gi,"");this.set("title",e)},getOpacity:function(){var e=(new Date).getTime()-this.get("lastEdited"),t=12096e5,n=e>t?.1:Math.round((.1+(t-e)/t*.9)*100)/100;return n}}),Doc}),define("models/settings",["require","jquery","backbone","localstorage"],function(e){function o(){i.resolve()}var t=e("jquery"),n=e("backbone"),r=e("localstorage"),i=t.Deferred(),s=n.Model.extend({defaults:{id:0,openDocId:undefined},localStorage:new r("appSettings"),initialize:function(){this.deferred=i.promise(),this.fetch({success:o,error:o})}});return new s}),define("collections/docs",["require","jquery","underscore","backbone","localstorage","models/doc","models/settings","utils/backbone.remoteStorage-documents"],function(e){function f(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=e("localstorage"),s=e("models/doc"),o=e("models/settings"),u=e("utils/backbone.remoteStorage-documents"),a=r.Collection.extend({model:s,sync:u,initialize:function(e){this.deferred=t.Deferred(),this.on("change:content",this.ensureOrder).on("change:lastEdited",this.saveWhenIdle).on("change:title",this.updateUrl)},addNew:function(){this.add({id:n.uniqueId(),lastEdited:(new Date).getTime()})},comparator:function(e,t){return e.get("lastEdited")>t.get("lastEdited")?-1:1},saveTimeout:undefined,saveWhenIdle:function(e){clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout(n.bind(e.save,e),1e3)},updateUrl:function(e){var t=encodeURI(e.get("title").toLowerCase().replace(/\s|&nbsp;/g,"-"));if(t.length<1){e.set("url","");return}var n=this.filter(function(e){return(new RegExp("^"+f(t)+"(-[0-9]|$)")).test(e.get("url"))}).length;t=n<1?t:t+"-"+n,e.set("url",t)},ensureOrder:function(){o.get("openDocId")!==this.first().id&&this.sort()},deleteEmpty:function(){var e=this.get(o.previous("openDocId"));e&&e.isEmpty()&&e.destroy()}}),l=new a;return l}),define("views/entries",["require","jquery","underscore","backbone","text!templates/entries.html","collections/docs","models/settings"],function(e){var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=e("text!templates/entries.html"),s=e("collections/docs"),o=e("models/settings"),u=r.View.extend({el:"#entries",initialize:function(){this.template=n.template(i),s.deferred.done(n.bind(this.render,this)),s.on("reset",this.render,this).on("change:title",this.updateTitle,this).on("destroy",this.removeItem,this),o.on("change:openDocId",this.selectOpenDoc,this)},render:function(){this.$el.html(this.template({docs:s.filter(function(e){return!e.isEmpty()}).map(function(e){var t=e.toJSON();return t.opacity=e.getOpacity(),t})})),this.selectOpenDoc()},$itemById:function(e){return this.$(".item[data-id="+e+"]")},updateTitle:function(e){var t=this.$itemById(e.id).find("a");t.length&&!e.isEmpty()?t.html(e.get("title")):this.render()},removeItem:function(e){this.$itemById(e.id).remove()},selectOpenDoc:function(){this.$selected&&this.$selected.removeClass("selected"),this.$selected=this.$itemById(o.get("openDocId")).addClass("selected")},events:{"click .item":"openDoc"},openDoc:function(e){e.preventDefault(),t("#menu-button").removeClass("hide"),o.save("openDocId",this.$(e.currentTarget).attr("data-id"))}});return u}),define("utils/cache",["require","jquery"],function(e){var t=e("jquery"),n={loading:t.Deferred(),isMac:/Mac/.test(navigator.platform),isMobile:matchMedia("(max-width:720px)").matches};return n}),define("views/editor",["require","jquery","underscore","backbone","models/settings","utils/cache"],function(e){var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=e("models/settings"),s=e("utils/cache"),o=r.View.extend({el:"#editor",initialize:function(){s.loading.done(n.bind(this.render,this)),i.on("change:openDocId",this.render,this)},render:function(){this.focus();var e=s.openDoc.get("content");e?this.$el.html(e):this.$el.text(" ")},focus:function(){this.$el.focus()},events:{keyup:"updateOpenDoc"},updateOpenDoc:function(){s.openDoc.set("content",this.$el.html())}});return o}),define("views/app",["require","jquery","underscore","backbone","views/entries","views/editor","collections/docs","utils/cache","models/settings"],function(e){var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=e("views/entries"),s=e("views/editor"),o=e("collections/docs"),u=e("utils/cache"),a=e("models/settings"),f=r.View.extend({el:"body",initialize:function(){this.editor=new s,this.entries=new i,u.isMobile||(setTimeout(n.bind(function(){this.aside("hidden")},this),3e3),o.on("add",function(){this.aside("visible")},this),o.on("change:title",function(){setTimeout(n.bind(function(){this.aside("hidden")},this),1e3)},this),o.on("fetch",function(){this.aside("visible")},this));var e=this;t("#editor").scroll(function(t){e.toggleMenuButton(t)}),t("#entries").scroll(function(t){e.toggleMenuButton(t)})},aside:function(){var e=this.$("aside");return function(t){t?t==="visible"?e.addClass("visible"):t==="hidden"&&o.length>2&&!u.openDoc.isEmpty()&&e.removeClass("visible"):e.toggleClass("visible")}}(),events:{"click #add":"newDoc","click #aside":"toggleAside","click #menu-button":"toggleAside",scroll:"toggleMenuButton",keydown:"handleKey",keyup:"hideAside"},newDoc:function(e){e.preventDefault(),u.openDoc.isEmpty()?this.editor.focus():o.addNew()},toggleAside:function(e){e.stopImmediatePropagation(),t("#menu-button").removeClass("hide"),this.aside()},toggleMenuButton:function(e){t(e.currentTarget).scrollTop()>20?t("#menu-button").addClass("hide"):t("#menu-button").removeClass("hide")},handleKey:function(e){if(e.which===9)e.preventDefault();else if(u.isMac?e.ctrlKey:e.altKey){this.aside("visible");if(e.which===78)this.newDoc(e);else{if(e.which===38)return this.openPreviousDoc(),!1;if(e.which===40)return this.openNextDoc(),!1}}},hideAside:function(e){e.which===(u.isMac?17:18)&&this.aside("hidden")},openPreviousDoc:function(){var e=o.at(o.indexOf(u.openDoc)-1);e&&a.save("openDocId",e.id)},openNextDoc:function(){var e=o.at(o.indexOf(u.openDoc)+1);e&&a.save("openDocId",e.id)}});return f}),define("utils/router",["require","backbone","models/settings","utils/cache","collections/docs"],function(e){var t=e("backbone"),n=e("models/settings"),r=e("utils/cache"),i=e("collections/docs"),s=t.Router.extend({routes:{"":"openLastEdited",":url":"openDoc"},openLastEdited:function(){this.navigate(r.openDoc.get("url"),{trigger:!0,replace:!0})},openDoc:function(e){var t=i.find(function(t){return t.get("url")===e},this);_.isUndefined(t)?this.navigate("",{trigger:!0,replace:!0}):n.set("openDocId",t.id)}});return new s}),define("litewrite",["require","jquery","backbone","views/app","collections/docs","utils/cache","models/settings","utils/router"],function(e){function a(){o.on("change:openDocId",c).on("change:openDocId",h).on("change:openDocId",v).on("change:openDocId",i.deleteEmpty,i),i.on("change:title",v).on("change:title",h).on("add",p),remoteStorage.onWidget("ready",m),remoteStorage.onWidget("state",function(e){e==="anonymous"?m():e=="disconnected"&&i.reset().addNew()}),t.when(o.deferred,i.deferred).done(f),s.loading.done(h,d),remoteStorage.displayWidget("remotestorage-connect"),remoteStorage.util.silenceAllLoggers(),t(function(){new r})}function f(){l(),c(),s.loading.resolve()}function l(){_.isUndefined(o.get("openDocId"))&&o.save("openDocId",i.first().id)}function c(){s.openDoc=i.get(o.get("openDocId"))}function h(){document.title=(s.openDoc?s.openDoc.get("title"):null)||"Litewrite"}function p(e){o.save("openDocId",e.id)}function d(){n.history.start()}function v(){u.navigate(s.openDoc.get("url"))}function m(){i.trigger("fetch"),i.fetch({success:function(){i.isEmpty()&&i.addNew(),i.deferred.resolve()}})}var t=e("jquery"),n=e("backbone"),r=e("views/app"),i=e("collections/docs"),s=e("utils/cache"),o=e("models/settings"),u=e("utils/router");return a}),define("utils/customizations",["require","backbone"],function(e){var t=e("backbone");t.Model.prototype.toggle=function(e,t){var n={};return n[e]=!this.get(e),this.set(n,t),this}}),require.config({deps:["utils/log","libs/matchMedia"],paths:{text:"libs/require.text",jquery:["http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min","libs/jquery.min"],underscore:"libs/underscore",backbone:"libs/backbone",localstorage:"libs/backbone.localstorage",remotestorage:["libs/remoteStorage"],"remotestorage-documents":"libs/remoteStorage-documents"},baseUrl:"js"}),require(["litewrite","utils/customizations"],function(e){e()}),define("main",[],function(){})})()