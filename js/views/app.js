define(["require","jquery","underscore","backbone","views/entries","views/editor","collections/docs","utils/cache","models/settings"],function(e){var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=e("views/entries"),s=e("views/editor"),o=e("collections/docs"),u=e("utils/cache"),a=e("models/settings"),f=r.View.extend({el:"body",initialize:function(){this.editor=new s,this.entries=new i,u.isMobile||(setTimeout(n.bind(function(){this.aside("hidden")},this),3e3),o.on("add",function(){this.aside("visible")},this),o.on("change:title",function(){setTimeout(n.bind(function(){this.aside("hidden")},this),1e3)},this),o.on("fetch",function(){this.aside("visible")},this));var e=this;t("#editor").scroll(function(t){e.toggleMenuButton(t)}),t("#entries").scroll(function(t){e.toggleMenuButton(t)})},aside:function(){var e=this.$("aside");return function(t){t?t==="visible"?e.addClass("visible"):t==="hidden"&&o.length>2&&!u.openDoc.isEmpty()&&e.removeClass("visible"):e.toggleClass("visible")}}(),events:{"click #add":"newDoc","click #aside":"toggleAside","click #menu-button":"toggleAside",scroll:"toggleMenuButton",keydown:"handleKey",keyup:"hideAside"},newDoc:function(e){e.preventDefault(),u.openDoc.isEmpty()?this.editor.focus():o.addNew()},toggleAside:function(e){e.stopImmediatePropagation(),t("#menu-button").removeClass("hide"),this.aside()},toggleMenuButton:function(e){t(e.currentTarget).scrollTop()>20?t("#menu-button").addClass("hide"):t("#menu-button").removeClass("hide")},handleKey:function(e){if(e.which===9)e.preventDefault();else if(u.isMac?e.ctrlKey:e.altKey){this.aside("visible");if(e.which===78)this.newDoc(e);else{if(e.which===38)return this.openPreviousDoc(),!1;if(e.which===40)return this.openNextDoc(),!1}}},hideAside:function(e){e.which===(u.isMac?17:18)&&this.aside("hidden")},openPreviousDoc:function(){var e=o.at(o.indexOf(u.openDoc)-1);e&&a.save("openDocId",e.id)},openNextDoc:function(){var e=o.at(o.indexOf(u.openDoc)+1);e&&a.save("openDocId",e.id)}});return f})