/* remoteStorage.js 0.7.0-head remoteStoragejs.com, MIT-licensed */

/**
 * almond 0.1.4 Copyright (c) 2011, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*
 * Mailcheck https://github.com/Kicksend/mailcheck
 * Author
 * Derrick Ko (@derrickko)
 *
 * License
 * Copyright (c) 2012 Receivd, Inc.
 *
 * Licensed under the MIT License.
 *
 * v 1.1
 *
 * ------------------------------------
 * remoteStorage.js modifications:
 *
 * 2012-10-24:
 * - added AMD wrapper
 * - removed jQuery stuff
 * - replaced defaultDomains with our own version
 */

/*
 * Edit distance calculation. Taken from https://github.com/cfq/levenshtein.js
 * (license not mentioned, so I assume public domain)
 */

//         remoteStorage.contacts.list().map(function(c) {

/**
 * JSONSchema Validator - Validates JavaScript objects using JSON Schemas
 *	(http://www.json.com/json-schema-proposal/)
 *
 * Copyright (c) 2007 Kris Zyp SitePen (www.sitepen.com)
 * Licensed under the MIT (MIT-LICENSE.txt) license.
To use the validator call the validate function with an instance object and an optional schema object.
If a schema is provided, it will be used to validate. If the instance object refers to a schema (self-validating),
that schema will be used to validate and the schema parameter is not necessary (if both exist,
both validations will occur).
The validate method will return an array of validation errors. If there are no errors, then an
empty list will be returned. A validation error will have two properties:
"property" which indicates which property had the error
"message" which indicates what the error was
 */

(function(){var e,t,n;(function(r){function i(e,t){var n,r,i,s,o,u,a,f,l,c,h=t&&t.split("/"),p=v.map,d=p&&p["*"]||{};if(e&&e.charAt(0)==="."&&t){h=h.slice(0,h.length-1),e=h.concat(e.split("/"));for(f=0;f<e.length;f+=1){c=e[f];if(c===".")e.splice(f,1),f-=1;else if(c===".."){if(f===1&&(e[2]===".."||e[0]===".."))break;f>0&&(e.splice(f-1,2),f-=2)}}e=e.join("/")}if((h||d)&&p){n=e.split("/");for(f=n.length;f>0;f-=1){r=n.slice(0,f).join("/");if(h)for(l=h.length;l>0;l-=1){i=p[h.slice(0,l).join("/")];if(i){i=i[r];if(i){s=i,o=f;break}}}if(s)break;!u&&d&&d[r]&&(u=d[r],a=f)}!s&&u&&(s=u,o=a),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function s(e,t){return function(){return h.apply(r,g.call(arguments,0).concat([e,t]))}}function o(e){return function(t){return i(t,e)}}function u(e){return function(t){p[e]=t}}function a(e){if(d.hasOwnProperty(e)){var t=d[e];delete d[e],m[e]=!0,c.apply(r,t)}if(!p.hasOwnProperty(e))throw new Error("No "+e);return p[e]}function f(e,t){var n,r,s=e.indexOf("!");return s!==-1?(n=i(e.slice(0,s),t),e=e.slice(s+1),r=a(n),r&&r.normalize?e=r.normalize(e,o(t)):e=i(e,t)):e=i(e,t),{f:n?n+"!"+e:e,n:e,p:r}}function l(e){return function(){return v&&v.config&&v.config[e]||{}}}var c,h,p={},d={},v={},m={},g=[].slice;c=function(e,t,n,i){var o,c,h,v,g,y=[],b;i=i||e;if(typeof n=="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(g=0;g<t.length;g+=1){v=f(t[g],i),c=v.f;if(c==="require")y[g]=s(e);else if(c==="exports")y[g]=p[e]={},b=!0;else if(c==="module")o=y[g]={id:e,uri:"",exports:p[e],config:l(e)};else if(p.hasOwnProperty(c)||d.hasOwnProperty(c))y[g]=a(c);else if(v.p)v.p.load(v.n,s(i,!0),u(c),{}),y[g]=p[c];else if(!m[c])throw new Error(e+" missing "+c)}h=n.apply(p[e],y);if(e)if(o&&o.exports!==r&&o.exports!==p[e])p[e]=o.exports;else if(h!==r||!b)p[e]=h}else e&&(p[e]=n)},e=t=h=function(e,t,n,i,s){return typeof e=="string"?a(f(e,t).f):(e.splice||(v=e,t.splice?(e=t,t=n,n=null):e=r),t=t||function(){},typeof n=="function"&&(n=i,i=s),i?c(r,e,t,n):setTimeout(function(){c(r,e,t,n)},15),h)},h.config=function(e){return v=e,h},n=function(e,t,n){t.splice||(n=t,t=[]),d[e]=[e,t,n]},n.amd={jQuery:!0}})(),n("../build/lib/almond",[],function(){}),n("lib/assets",[],function(){return{remoteStorageIcon:"data:image/png;base64,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",widgetCss:"#remotestorage-state {     position:fixed;     top:5px;     right:5px;     height:32px;     width:275px;     font:normal 16px/100% sans-serif;     z-index:99999;     background:rgba(0,0,0,.3);     padding:5px;     border-radius:7px;     box-shadow:0 1px rgba(255,255,255,.05), inset 0 1px rgba(0,0,0,.05);     transition:width 500ms, background 500ms; }  #remotestorage-state.connected, #remotestorage-state.busy, #remotestorage-state.offline {     width:32px;     background:none;     box-shadow:none; } .remotestorage-button {     margin:0;     padding:.3em;     font-size:14px;     height:26px !important;     background:#ddd;     color:#333;     border:1px solid #ccc;     border-radius:3px;     box-shadow:0 1px 1px #fff inset; }  #remotestorage-register-button {     position:absolute;     left:25px;     top:8px;     max-height:16px;     text-decoration:none;     font-weight:normal;     cursor:pointer; }  #remotestorage-connect-button {     position:absolute;     right:8px;     top:8px;     padding:0 0 0 17px;     width:90px;     cursor:pointer;     text-align:left;     border-radius:0 3px 3px 0;     font-weight:normal; }  #remotestorage-connect-button:hover, #remotestorage-connect-button:focus, .remotestorage-button:hover, .remotestorage-button:focus, #remotestorage-sync-button:hover, #remotestorage-sync-button:focus {     background:#eee;     color:#000;     text-decoration:none; }  #remotestorage-useraddress {     position:absolute;     left:25px;     top:8px;     margin:0;     padding:0 17px 0 3px;     height:25px;     width:142px;     background:#eee;     color:#333;     border:0;     border-radius:3px 0 0 3px;     box-shadow:0 1px #fff, inset 0 1px #999;     font-weight:normal;     font-size:14px; }  #remotestorage-useraddress:hover, #remotestorage-useraddress:focus {     background:#fff;     color:#000; }  #remotestorage-cube {     position:absolute;     right:84px;     -webkit-transition:right 500ms;     -moz-transition:right 500ms;     transition:right 500ms;     z-index:99997; }  #remotestorage-questionmark {     position:absolute;     left:0;     padding:9px 8px;     color:#fff;     text-decoration:none;     z-index:99999;     font-weight:normal; }  .infotext {     position:absolute;     left:0;     top:0;     width:255px;     height:32px;     padding:6px 5px 4px 25px;     font-size:10px;     background:black;     color:white;     border-radius:7px;     opacity:.85;     text-decoration:none;     white-space:nowrap;     z-index:99998; }  #remotestorage-questiomark:hover {     color:#fff; }  #remotestorage-questionmark:hover+#remotestorage-infotext {     display:inline; }  #remotestorage-state.busy #remotestorage-cube, #remotestoreage-state.authing #remotestorage-cube, #remotestorage-state.connecting #remotestorage-cube {     -webkit-animation-name:remotestorage-loading;     -webkit-animation-duration:2s;     -webkit-animation-iteration-count:infinite;     -webkit-animation-timing-function:linear;     -moz-animation-name:remotestorage-loading;     -moz-animation-duration:2s;     -moz-animation-iteration-count:infinite;     -moz-animation-timing-function:linear;     -o-animation-name:remotestorage-loading;     -o-animation-duration:2s;     -o-animation-iteration-count:infinite;     -o-animation-timing-function:linear;     -ms-animation-name:remotestorage-loading;     -ms-animation-duration:2s;     -ms-animation-iteration-count:infinite;     -ms-animation-timing-function:linear; } @-webkit-keyframes remotestorage-loading { from{-webkit-transform:rotate(0deg)} to{-webkit-transform:rotate(360deg)} } @-moz-keyframes remotestorage-loading { from{-moz-transform:rotate(0deg)} to{-moz-transform:rotate(360deg)} } @-o-keyframes remotestorage-loading { from{-o-transform:rotate(0deg)} to{-o-transform:rotate(360deg)} } @-ms-keyframes remotestorage-loading { from{-ms-transform:rotate(0deg)} to{ -ms-transform:rotate(360deg)} }  #remotestorage-connect-button, #remotestorage-questionmark, #remotestorage-register-button, #remotestorage-cube, #remotestorage-useraddress, #remotestorage-infotext, #remotestorage-devsonly, #remotestorage-bubble {     display:none }  #remotestorage-state.anonymous #remotestorage-cube, #remotestorage-state.anonymous #remotestorage-connect-button, #remotestorage-state.anonymous #remotestorage-register-button, #remotestorage-state.anonymous #remotestorage-questionmark {     display: block }  #remotestorage-state.connecting #remotestorage-cube, #remotestorage-state.connecting #remotestorage-connect-button, #remotestorage-state.connecting #remotestorage-useraddress, #remotestorage-state.connecting #remotestorage-questionmark {     display: block }  #remotestorage-state.interrupted #remotestorage-cube, #remotestorage-state.interrupted #remotestorage-connect-button, #remotestorage-state.interrupted #remotestorage-register-button, #remotestorage-state.interrupted #remotestorage-questionmark {     display: block }  #remotestorage-state.failed #remotestorage-cube, #remotestorage-state.failed #remotestorage-connect-button, #remotestorage-state.failed #remotestorage-register-button, #remotestorage-state.failed #remotestorage-questionmark {     display: block }  #remotestorage-state.authing #remotestorage-cube, #remotestorage-state.authing #remotestorage-connect-button, #remotestorage-state.authing #remotestorage-useraddress, #remotestorage-state.authing #remotestorage-questionmark {     display: block }  #remotestorage-state.typing #remotestorage-cube, #remotestorage-state.typing #remotestorage-connect-button, #remotestorage-state.typing #remotestorage-useraddress, #remotestorage-state.typing #remotestorage-questionmark {     display: block }  #remotestorage-state.connected #remotestorage-cube, #remotestorage-state.busy #remotestorage-cube, #remotestorage-state.offline #remotestorage-cube {     right:0;     opacity:.5;     cursor:pointer;     display: block }  #remotestorage-state.devsonly #remotestorage-devsonly {     display: block }  #remotestorage-bubble {     position:absolute;     right:6px;     top:9px;     padding:5px 28px 2px 6px;     height:17px;     white-space:nowrap;     font-size:10px;     background:#000;     color:#fff;     border-radius:5px;     opacity:.5;     text-decoration:none;     z-index:99996; }  #remotestorage-state.connected #remotestorage-bubble, #remotestorage-state.busy #remotestorage-bubble, #remotestorage-state.offline #remotestorage-bubble {     cursor:pointer; }  #remotestorage-bubble strong {     font-weight:bold; }  #remotestorage-state.connected #remotestorage-cube:hover, #remotestorage-state.busy #remotestorage-cube:hover, #remotestorage-state.offline #remotestorage-cube:hover {     opacity:1; }  #remotestorage-state.connected #remotestorage-bubble:hover, #remotestorage-state.busy #remotestorage-bubble:hover, #remotestorage-state.offline #remotestorage-bubble:hover {     display:inline; }  #remotestorage-state.connected:hover #remotestorage-bubble, #remotestorage-state.busy:hover #remotestorage-bubble, #remotestorage-state.offline:hover #remotestorage-bubble {     display:inline; }  /* #remotestorage-state.connected #remotestorage-cube:hover+#remotestorage-bubble, #remotestorage-state.busy #remotestorage-cube:hover+#remotestorage-bubble, #remotestorage-state.offline #remotestorage-cube:hover+#remotestorage-bubble { */ /*     display:inline; */ /* } */  #remotestorage-menu {     background: #000;     border-radius: 5px;     color: #fff;     font-size: 10px;     opacity: .5;     padding: 6px;     position: absolute;     right: 5px;     top: 40px; }  #remotestorage-menu .item {     white-space: nowrap; }  #remotestorage-menu .item button {     font-size: 10px;     margin-left: 6px; }",remoteStorageCube:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAR2SURBVFiFtddfqGVVHQfwz2/vfZ28c2WgP6hMoYkUV4qIYnSKmaQYwaaJ3oLeUnpJmDCmUhCaIhhKGelhelCqN9+ECKdAxR6kgnJASBN9KTGwP2oKTtyZs8/+9bDXPufcfe51xju6YLHX2fu3ft/v+q7fWb/fisy0o3brez6qmt4Luvo7frvx/E7cxNsmcCj2WGnuEb6JaXlbSz8zaX/ksXzj3SHwg6j8aeU28jjeh8TZ8nU3Aq8Sx+2b/ML3s3vnCHxp5YB0Hz6OTkgpMax2jxBSoMJfhGMemTx5aQQOxzWsnCC/gm6hZ+mvFMv36xUYCJQev2Jyt9P54tsj8OVYNW2+izuxIkzlAoGUQuLlMuNqKcQCgVBJNSa4X93+xK/zfxcmcLj5GtUJ8ipMC/i0gA/PQYF/lFkfHClQFxJ1IVET/6S72+n2oa0JHL7s0+RPsR9tAZuOxuNtGKS9xpL8A7BmNP4j8S2nzz+lGJaWDxB7RyCbV54DkZiSrbAhbJBt/25LtUbEY2+P1bdmQY1V8mr8DruET5Z9n4NHTOmmZK9A2ihzp3RdL3tVy+z16OeG0ElncI48yGzeogIzQgexByelp2fMZ+CDAtFK56XzxFwBXSE6C9incbL4PDha9BKBPrjCddJRVT5DHsMLczkLUGhFbPR9iJNYjJUXyGOqfEY6KlxnHrybVjwm0JVDJmV8FZ8TeZysZdyBK9FKXb/6mdTZ+4uXRXcKUxnHpavKdqV58G5JYJFdLvT3yuok3ROiuY3JZ3Rxu7CH7lxvHlPpNVX+nJU/yMk9VJ8nm5GvMc42W6Bwnhl2KRyQ7cOyaqy1R0ScEvFq6aestUdk1cj2YeEA3RwwtwbfSoHtxxmJXeS3nV25RR0/9KnJL8GZyz7i7MoD5MfQ9LZ5YZ+WY+AiW16vc8if/av8PkRevxNPiwTiLceRISPIM3iUOGxa/wfUbiTvxy3ETb3tRfi0HAMx+xgLY1XIeAUPYoO4S+YNqupyVXW5zBuIu/pvHuxtq5j5DLHkfxsFxoaBlN1vVKbEN2TQ5wdYLc8++YibhZvJx3VZizgy8rVEYhwDfUKZFxd/Jf8m4gsydtENJ17TZ8lcLbOGrFfJrKmOiDxHPk58GJ8oPqu3UmDOLr2B5/AhYt08K9Z9AMdAsCeQml6BnKdiriC+iP/iKWkdH7gQgSRfQoi4SWoLcMqsRaUcZiX1xu4yrZmpp6p721lavlLYK/PfeIm4djsCE7xZDNqSVocV9evNJCKIjq6TuTbbAlWvQGZfiCwWJqkqqb7pMUwG0IV/QXwdz1ouKjZXOP021EQjqt2i2k00/Tv1Evj8OfRnC1aPeokl2e/LrM/aYUk2Pgc43T6knqzjBCZytqqhpGpK0DXCmrC26d1Qgs3BJzihnqyPwbdWYJMaFyzLnyuW6yMFLrEsH7ftLyZ/LxbX7vRisrwFW7VHJk/a1+4njuL1udx5Rd9nW/A6cdS+dv/FgHPpl9PhorH67l9Ox62/nv8YdPX3dno9/z+G+TGrzjgPKwAAAABJRU5ErkJggg=="}}),n("lib/util",[],function(){var e={},t={},n=["base","sync","webfinger","getputdelete","platform","baseClient","widget","store","foreignClient","schedule"],r=null,i={toArray:function(e){return Array.prototype.slice.call(e)},isDir:function(e){return e.substr(-1)=="/"},pathParts:function(e){var t=["/"],n;while(n=e.match(/^(.*?)([^\/]+\/?)$/))t.unshift(n[2]),e=n[1];return t},extend:function(e,t){for(var n in t)e[n]=t[n];return e},containingDir:function(e){var t=e.replace(/[^\/]+\/?$/,"");return t==e?null:t},baseName:function(e){var t=e.split("/");return i.isDir(e)?t[t.length-2]+"/":t[t.length-1]},bindAll:function(e){for(var t in e)typeof e[t]=="function"&&(e[t]=this.bind(e[t],e));return e},curry:function(e){var t=Array.prototype.slice.call(arguments,1);return function(){var n=Array.prototype.slice.call(arguments);for(var r=t.length-1;r>=0;r--)n.unshift(t[r]);return e.apply(this,n)}},bind:function(e,t){return t?function(){return e.apply(t,arguments)}:e},deprecate:function(e,t){console.trace(),console.log("WARNING: "+e+" is deprecated, use "+t+" instead")},highestAccess:function(e,t){return e=="rw"||t=="rw"?"rw":e=="r"||t=="r"?"r":null},getEventEmitter:function(){return this.bindAll({_handlers:function(){var e=Array.prototype.slice.call(arguments),t={};return e.forEach(function(e){t[e]=[]}),t}.apply(null,arguments),emit:function(e){var t=Array.prototype.slice.call(arguments,1);if(!this._handlers[e])throw"Unknown event: "+e;this._handlers[e].forEach(function(e){e&&e.apply(null,t)})},once:function(e,t){var n=this._handlers[e].length;if(typeof t!="function")throw"Expected function as handler, got: "+typeof t;this.on(e,function(){delete this._handlers[e][n],t.apply(this,arguments)}.bind(this))},on:function(e,t){if(!this._handlers[e])throw"Unknown event: "+e;if(typeof t!="function")throw"Expected function as handler, got: "+typeof t;this._handlers[e].push(t)}})},getLogger:function(n){return e[n]||(e[n]={info:function(){this.log("info",i.toArray(arguments))},debug:function(){this.log("debug",i.toArray(arguments),"debug")},error:function(){this.log("error",i.toArray(arguments),"error")},log:function(e,i,s){if(r)return r(n,e,i);if(t[n])return;s||(s="log"),i.unshift("["+n.toUpperCase()+"] -- "+e+" "),(console[s]||console.log).apply(console,i)}}),e[n]},setLogFunction:function(e){r=e},silenceLogger:function(){var e=i.toArray(arguments);for(var n=0;n<e.length;n++)t[e[n]]=!0},unsilenceLogger:function(){var e=i.toArray(arguments);for(var n=0;n<e.length;n++)delete t[e[n]]},silenceAllLoggers:function(){this.silenceLogger.apply(this,n)},unsilenceAllLoggers:function(){this.unsilenceLogger.apply(this,n)},grepLocalStorage:function(e,t){for(var n=0;n<localStorage.length;n++){var r=localStorage.key(n);e.test(r)&&t(r)}}};return i}),n("lib/platform",["./util"],function(e){function n(e){var t={};for(var n in e)t[n.toLowerCase()]=e[n];return t}function r(e){if(!e)return null;var t={},r=e.split(/\r?\n/),i=null,s,o,u;for(var a=0;a<r.length;a++){if(r[a].length==0)continue;(s=r[a].match(/^([^:]+):\s*(.+)$/))?(o=s[1],u=s[2],t[o]=u,i=o):(s=r[a].match(/^\s+(.+)$/))?(o=i,u=s[1],t[o]=t[o]+u):x.error("Failed to parse header line: "+r[a])}return n(t)}function i(e){var t=!1,n,i=new XMLHttpRequest;e.timeout&&(n=window.setTimeout(function(){t=!0,i.abort(),e.error("timeout")},e.timeout)),e.method||(e.method="GET"),i.open(e.method,e.url,!0);if(e.headers)for(var s in e.headers)i.setRequestHeader(s,e.headers[s]);i.onreadystatechange=function(){if(i.readyState==4){n&&window.clearTimeout(n);if(i.status==200||i.status==201||i.status==204||i.status==207){var t=r(i.getAllResponseHeaders());t||(t={"content-type":i.getResponseHeader("Content-Type")}),e.success(i.responseText,t)}else e.error(i.status||"unknown error")}},typeof e.data=="string"?i.send(e.data):i.send()}function s(e){var t=new XDomainRequest;t.timeout=e.timeout||3e3,t.open(e.method,e.url),t.onload=function(){t.status==200||t.status==201||t.status==204?e.success(xhr.responseText):e.error(xhr.status)},t.onerror=function(){err("unknown error")},t.ontimeout=function(){err(timeout)},e.data?t.send(e.data):t.send()}function o(e){var r=t("http"),i=t("https"),s=t("url");e.method||(e.method="GET"),e.data?e.headers["content-length"]=e.data.length:e.data=null;var o=s.parse(e.url),u={method:e.method,host:o.hostname,path:o.path,port:o.port?port:o.protocol=="https:"?443:80,headers:e.headers},a,f;e.timeout&&(a=setTimeout(function(){e.error("timeout"),f=!0},e.timeout));var l=o.protocol=="https:"?i:r,c=l.request(u,function(t){var r="";t.setEncoding("utf8"),t.on("data",function(e){r+=e}),t.on("end",function(){a&&clearTimeout(a),f||(t.statusCode==200||t.statusCode==201||t.statusCode==204?e.success(r,n(t.headers)):e.error(t.statusCode))})});c.on("error",function(t){a&&clearTimeout(a),e.error(t.message)}),e.data?c.end(e.data):c.end()}function u(e,t){var n=(new DOMParser).parseFromString(e,"text/xml"),r=n.getElementsByTagName("Link"),i={Link:[]};for(var s=0;s<r.length;s++){var o={};if(r[s].attributes)for(var u=0;u<r[s].attributes.length;u++)o[r[s].attributes[u].name]=r[s].attributes[u].value;var a=r[s].getElementsByTagName("Property");o.properties={};for(var f=0;f<a.length;f++)o.properties[a[f].getAttribute("type")]=a[f].childNodes[0].nodeValue;o.rel&&i.Link.push({"@":o})}t(null,i)}function a(e,n){var r=t("xml2js");(new r.Parser).parseString(e,n)}function f(){}function l(e){if(location.hash.length){var t=location.hash.substring(1).split("&");for(var n=0;n<t.length;n++)if(t[n].substring(0,(e+"=").length)==e+"="){var r=decodeURIComponent(t[n].substring((e+"=").length));return delete t[n],location="#"+t.join("&"),r}}}function c(e,t){}function h(e,t){var n=e;n instanceof Element||(n=document.getElementById(e)),n.innerHTML=t}function p(e){}function d(e){return document.getElementById(e).value}function v(e,t,n){}function m(e,t,n){t=="click"?document.getElementById(e).onclick=n:t=="hover"?document.getElementById(e).onmouseover=n:t=="type"&&(document.getElementById(e).onkeyup=n)}function g(){return window.location.href.split("#")[0]}function y(){}function b(e){window.location=e}function w(){}function E(e){alert(e)}function S(e){console.log(e)}var x=e.getLogger("platform");return typeof window=="undefined"?{ajax:o,parseXml:a,harvestParam:f,setElementHTML:c,getElementValue:p,eltOn:v,getLocation:y,setLocation:w,alert:S}:window.XDomainRequest?{ajax:s,parseXml:u,harvestParam:l,setElementHTML:h,getElementValue:d,eltOn:m,getLocation:g,setLocation:b,alert:E}:{ajax:i,parseXml:u,harvestParam:l,setElementHTML:h,getElementValue:d,eltOn:m,getLocation:g,setLocation:b,alert:E}}),n("lib/webfinger",["./platform","./util"],function(e,t){function n(e,t){var n=e.toLowerCase().split("@");if(n.length<2)t("That is not a user address. There is no @-sign in it");else if(n.length>2)t("That is not a user address. There is more than one @-sign in it");else if(!/^[\.0-9a-z\-\_]+$/.test(n[0]))t('That is not a user address. There are non-dotalphanumeric symbols before the @-sign: "'+n[0]+'"');else if(!/^[\.0-9a-z\-]+$/.test(n[1]))t('That is not a user address. There are non-dotalphanumeric symbols after the @-sign: "'+n[1]+'"');else{var r="?resource=acct:"+encodeURIComponent(e);t(null,["https://"+n[1]+"/.well-known/host-meta.json"+r,"https://"+n[1]+"/.well-known/host-meta"+r,"http://"+n[1]+"/.well-known/host-meta.json"+r,"http://"+n[1]+"/.well-known/host-meta"+r])}}function r(t,n,o,u){var a=t.shift();u||(u=[]),a?e.ajax({url:a,success:function(e){s(e,function(s,u){s?i(e,function(e,i){e?r(t,n,o):o(null,i)}):o(null,u)})},error:function(e){u.push(e),r(t,n,o,u)},timeout:n}):o("could not fetch XRD: "+u[0])}function i(t,n){e.parseXml(t,function(e,t){if(e)n(e);else if(t&&t.Link){var r={};if(t.Link&&t.Link["@"])t.Link["@"].rel&&(r[t.Link["@"].rel]=t.Link["@"]);else for(var i=0;i<t.Link.length;i++)t.Link[i]["@"]&&t.Link[i]["@"].rel&&(r[t.Link[i]["@"].rel]=t.Link[i]["@"]);n(null,r)}else n("found valid xml but with no Link elements in there")})}function s(e,t){var n;try{n=JSON.parse(e)}catch(r){t("not valid JSON");return}n.links||t("JRD contains no links");var i={};for(var s=0;s<n.links.length;s++)n.links[s].rel&&(i[n.links[s].rel]=n.links[s]);t(null,i)}function o(e,t){e&&e.href&&e.type&&e.properties&&e.properties["auth-endpoint"]?t(null,e):t("could not extract storageInfo from lrdd")}function u(e,t,i){n(e,function(n,s){a.debug("HOST META ADDRESSES",s,"(error: ",n,")"),n?i(n):r(s,t.timeout,function(n,s){if(n)i("could not fetch host-meta for "+e+" ("+n+")");else if(s.remoteStorage||s.remotestorage)o(s.remoteStorage||s.remotestorage,i);else if(s.lrdd&&s.lrdd.template){var u=s.lrdd.template.split("{uri}"),a=[u.join("acct:"+e),u.join(e)];r(a,t.timeout,function(t,n){t?i("could not fetch lrdd for "+e):n.remoteStorage?o(n.remoteStorage,i):n.remotestorage?o(n.remotestorage,i):i("could not extract storageInfo from lrdd")})}else i("could not extract lrdd template from host-meta")})})}var a=t.getLogger("webfinger");return{getStorageInfo:u}}),n("lib/hardcoded",["./platform"],function(e){function t(t,n,r){e.ajax({url:"http://proxy.unhosted.org/irisCouchCheck?q=acct:"+t,success:function(e){var t;try{t=JSON.parse(e)}catch(n){}t?r(null,t):r("err: unparsable response from IrisCouch check")},error:function(e){r("err: during IrisCouch test:"+e)},timeout:n.timeout})}function n(e){var t=e.split("@");return["libredocs","mail","browserid","me"].indexOf(t[0])==-1?t[0]+"@iriscouch.com":t[2].substring(0,t[2].indexOf("."))+"@iriscouch.com"}function r(e,n,r){var s=e.split("@");if(s.length<2)r("That is not a user address. There is no @-sign in it");else if(s.length>2)r("That is not a user address. There is more than one @-sign in it");else if(!/^[\.0-9A-Za-z]+$/.test(s[0]))r('That is not a user address. There are non-dotalphanumeric symbols before the @-sign: "'+s[0]+'"');else if(!/^[\.0-9A-Za-z\-]+$/.test(s[1]))r('That is not a user address. There are non-dotalphanumeric symbols after the @-sign: "'+s[1]+'"');else{while(s[1].indexOf(".")!=-1){if(i[s[1]]){blueprint=i[s[1]],r(null,{rel:"https://www.w3.org/community/unhosted/wiki/personal-data-service-00",type:blueprint.type,href:blueprint.hrefPrefix+"/"+(blueprint.pathFormat=="user@host"?e:s[1]+"/"+s[0]),properties:{"access-methods":["http://oauth.net/core/1.0/parameters/auth-header"],"auth-methods":["http://oauth.net/discovery/1.0/consumer-identity/static"],"auth-endpoint":blueprint.authPrefix+e}});return}s[1]=s[1].substring(s[1].indexOf(".")+1)}new Date<new Date("9/9/2012")?t(e,n,r):r("err: not a guessable domain, and fakefinger-migration has ended")}}var i={"iriscouch.com":{type:"https://www.w3.org/community/unhosted/wiki/remotestorage-2011.10#couchdb",authPrefix:"http://proxy.unhosted.org/OAuth.html?userAddress=",hrefPrefix:"http://proxy.unhosted.org/CouchDb",pathFormat:"host/user"}};return function(){var e={type:"https://www.w3.org/community/unhosted/wiki/remotestorage-2011.10#simple",authPrefix:"https://storage.surfnetlabs.nl/saml/oauth/authorize?user_address=",hrefPrefix:"https://storage.surfnetlabs.nl/saml",pathFormat:"user@host"},t={type:"https://www.w3.org/community/unhosted/wiki/remotestorage-2011.10#simple",authPrefix:"https://storage.surfnetlabs.nl/browserid/oauth/authorize?user_address=",hrefPrefix:"https://storage.surfnetlabs.nl/browserid",pathFormat:"user@host"},n=["leidenuniv.nl","leiden.edu","uva.nl","vu.nl","eur.nl","maastrichtuniversity.nl","ru.nl","rug.nl","uu.nl","tudelft.nl","utwente.nl","tue.nl","tilburguniversity.edu","uvt.nl","wur.nl","wageningenuniversity.nl","ou.nl","lumc.nl","amc.nl","ahk.nl","cah.nl","driestar.nl","che.nl","chn.nl","hen.nl","huygens.nl","diedenoort.nl","efa.nl","dehaagsehogeschool.nl","hasdenbosch.nl","inholland.nl","hsbrabant.nl","dehorst.nl","kempel.nl","domstad.nl","hsdrenthe.nl","edith.nl","hsleiden.nl","interport.nl","schumann.nl","hsbos.nl","hva.nl","han.nl","hvu.nl","hesasd.nl","hes-rdam.nl","hku.nl","hmtr.nl","hzeeland.nl","hotelschool.nl","ichtus-rdam.nl","larenstein.nl","iselinge.nl","koncon.nl","kabk.nl","lhump.nl","msm.nl","hsmarnix.nl","nhtv.nl","nth.nl","nhl.nl","sandberg.nl","hsij.nl","stoas.nl","thrijswijk.nl","tio.nl","vhall.nl","chw.nl","hogeschoolrotterdam.nl"],r=["surfnet.nl","fontys.nl"];for(var s=0;s<r.length;s++)i[r[s]]=e;for(var s=0;s<n.length;s++)i[n[s]]=t}(),{guessStorageInfo:r}}),n("lib/getputdelete",["./platform","./util"],function(e,t){function n(e){return e["content-type"]?e["content-type"].split(";")[0]:(u.error("Falling back to default content type: ",a,JSON.stringify(e)),a)}function r(t,r,i,s,o,a,f){u.info(t,r);var l={url:r,method:t,error:function(e){e==401?e="unauthorized":e!=404&&u.error(t+" "+r+": ",e),a(e)},success:function(e,t){a(null,e,n(t))},timeout:f||5e3,headers:{}};o&&(l.headers.Authorization="Bearer "+o),s&&(l.headers["Content-Type"]=s),l.fields={withCredentials:"true"},t!="GET"&&(l.data=i),e.ajax(l)}function i(e,n,i){r("GET",e,null,null,n,function(n,r,s){if(n==404)i(null,undefined);else if(n)i(n);else{if(t.isDir(e))try{r=JSON.parse(r)}catch(o){i("unparseable directory index");return}i(null,r,s)}})}function s(e,t,n,i,s){typeof t!="string"&&s("invalid value given to PUT, only strings allowed, got "+typeof t),u.info("calling PUT "+e," ("+t.length+")"),r("PUT",e,t,n,i,function(e,t){s(e,t)})}function o(e,t,n,i,o){typeof t=="undefined"?r("DELETE",e,null,null,i,o):s(e,t,n,i,o)}var u=t.getLogger("getputdelete"),a="application/octet-stream";return{get:i,set:o}}),n("lib/wireClient",["./getputdelete","./util"],function(e,t){function n(e,t){localStorage.setItem(y+e,JSON.stringify(t)),u(),w=="connected"&&b.emit("connected")}function r(e){localStorage.removeItem(y+e)}function i(e){var t=localStorage.getItem(y+e);if(typeof t=="string")try{return JSON.parse(t)}catch(n){localStorage.removeItem(y+e)}return null}function s(){t.grepLocalStorage(new RegExp("^"+y),function(e){localStorage.removeItem(e)})}function o(){return w}function u(){return i("storageType")&&i("storageHref")?i("bearerToken")?w="connected":w="authing":w="anonymous",w}function a(e,t){b.on(e,t)}function f(e){var t=i("storageHref");return t+e}function l(e){return E.test(e)}function c(t,n){if(l(t))return h(t,n);w!="connected"&&n(new Error("not-connected"));var r=i("bearerToken");typeof t!="string"?n(new Error('argument "path" should be a string')):e.get(f(t),r,n)}function h(t,n){var r=t.match(E),i=r[1],s=r[2],o=v(i);e.get(o+s,null,n)}function p(t,n,r,s){if(l(t))return s(new Error("Foreign storage is read-only"));w!="connected"&&s(new Error("not-connected"));var o=i("bearerToken");typeof t!="string"?s(new Error('argument "path" should be a string')):(n&&typeof n!="string"&&(n=JSON.stringify(n)),e.set(f(t),n,r,o,s))}function d(t,n){if(l(t))return n(new Error("Foreign storage is read-only"));var r=i("bearerToken");e.set(f(t),undefined,undefined,r,n)}function v(e){var t=i("storageInfo:"+e);if(!t)throw new Error("userAddress unknown to wireClient: "+e);return t.href}function m(e,t){n("storageInfo:"+e,t)}function g(e){return!!i("storageInfo:"+e)}var y="remote_storage_wire_",b=t.getEventEmitter("connected","error"),w="anonymous",E=/^([^\/][^:]+):(\/.*)$/;return{get:c,set:p,remove:d,setStorageInfo:function(e,t){n("storageType",e),n("storageHref",t)},getStorageHref:function(){return i("storageHref")},setBearerToken:function(e){n("bearerToken",e)},addStorageInfo:m,hasStorageInfo:g,disconnectRemote:s,on:a,getState:o,calcState:u}}),n("lib/store",["./util"],function(e){function t(e,t,n){var i=r(t);C.emit("change",{path:t,origin:e,oldValue:n,newValue:u(t),timestamp:i.timestamp})}function n(e,t){var n=r(e);C.emit("foreign-change",{path:e,oldValue:t,newValue:u(e),timestamp:n.timestamp})}function r(t){if(!t)throw new Error("No path given!");g(t);var n=localStorage.getItem(x+t),r;if(n)try{r=JSON.parse(n)}catch(i){S.error("Invalid node data in store: ",n)}return r||(r={startAccess:null,startForce:null,startForceTree:null,timestamp:0,lastUpdatedAt:0,mimeType:"application/json"},e.isDir(t)&&(r.diff={})),r}function i(e){g(e),localStorage.removeItem(x+e),localStorage.removeItem(T+e)}function s(){for(var e=0;e<localStorage.length;e++)if(localStorage.key(e).substr(0,x.length)==x||localStorage.key(e).substr(0,T.length)==T)localStorage.removeItem(localStorage.key(e)),e--}function o(e,t,n,i,s){var o=r(e),a;if(!n){if(typeof i!="number")throw"Attempted to set non-number timestamp in incoming change: "+i+" ("+typeof i+")";o.lastUpdatedAt=i,a=u(e)}s||(s="application/json"),o.mimeType=s,w(e,t),E(e,t?o:undefined,n,!1,i,a)}function u(e,t){S.info("GET",e),g(e);var n=localStorage.getItem(T+e),i=r(e);if(n){if(!t&&i.mimeType=="application/json")try{return JSON.parse(n)}catch(s){C.emit("error","Invalid JSON node at "+e+": "+n)}return n}return undefined}function a(e,t){o(e,undefined,!1,t||m())}function f(e,t){var n=r(e);t!=n.startAccess&&(t=="rw"||n.startAccess==null)&&(n.startAccess=t,E(e,n,!1,!0))}function l(e,t,n){var i=r(e);i.startForce=t,i.startForceTree=n,E(e,i,!1,!0)}function c(e,t){var n=r(e);t?n.error=t:delete n.error,E(e,n,!1,!0)}function h(t,n){S.debug("clearDiff",t);var i=r(t);n&&(i.timestamp=i.lastUpdatedAt=n,E(t,i,!1,!0));var s=e.containingDir(t),o=e.baseName(t);if(s){var u=r(s);delete u.diff[o],E(s,u,!1,!0),Object.keys(u.diff).length===0&&h(s)}}function p(){function n(r){if(e.isDir(r)){var i=u(r);if(i)for(var s in i)n(r+s)}else t("device",r)}S.info("fire initial events"),n("/")}function d(e){return e.substring(0,x.length)==x}function v(t){var n=t.split("/");return e.isDir(t)?n[n.length-2]+"/":n[n.length-1]}function m(){return(new Date).getTime()}function g(e){if(e[0]!="/"&&!N.test(e))throw new Error("Invalid path: "+e)}function y(e){return e[0]!="/"}function b(e){var t=u(e);if(t){var n=[];for(var r in t)n.push(t[r]);return Math.max.apply(Math,n)}return m()}function w(e,t){g(e);if(!e)throw new Error("Path is required!");var n;typeof t!="undefined"?(typeof t=="object"?n=JSON.stringify(t):n=t,localStorage.setItem(T+e,n)):localStorage.removeItem(T+e)}function E(i,s,o,a,f,l){g(i);if(!a&&!f)if(o)f=m();else{if(!e.isDir(i))throw new Error("no timestamp given for node "+i);f=b(i)}s&&typeof f=="number"&&(s.timestamp=f),s?localStorage.setItem(x+i,JSON.stringify(s)):localStorage.removeItem(x+i);var c=e.containingDir(i);if(c){var h=r(c),p=u(c)||{},d=v(i);if(a){if(!p||!p[d])p[d]=0,w(c,p);E(c,h,!1,!0,f)}else if(o)s?p[d]=f:delete p[d],h.diff[d]=f,w(c,p),E(c,h,!0,!1,f);else{if(s){if(!p[d]||p[d]<f)p[d]=f,delete h.diff[d],w(c,p),E(c,h,!1,!1,f)}else p[d]&&(delete p[d],delete h.diff[d],w(c,p),E(c,h,!1,!1,f));e.isDir(i)||(y(i)?n(i,l):t("remote",i,l))}}}var S=e.getLogger("store"),x="remote_storage_nodes:",T="remote_storage_node_data:",N=/^[^@]+@[^:]+:\//,C=e.getEventEmitter("error","change","foreign-change");return typeof window!="undefined"&&window.addEventListener("storage",function(n){d(n.key)&&(e.isDir(n.key)||t("device",n.key.substring(x.length),n.oldValue))}),{getNode:r,getNodeData:u,setNodeData:o,clearDiff:h,removeNode:a,setNodeError:c,on:C.on,setNodeAccess:f,setNodeForce:l,forget:i,forgetAll:s,fireInitialEvents:p}}),n("lib/sync",["./wireClient","./store","./util"],function(e,t,n){function r(e){var t=localStorage.getItem(z+e);try{t=JSON.parse(t)}catch(n){}return t}function i(e,t){return typeof t!="string"&&(t=JSON.stringify(t)),localStorage.setItem(z+e,t)}function s(){for(var e=0;e<localStorage.length;e++){var t=localStorage.key(e);t.match(new RegExp("^"+z))&&localStorage.removeItem(t)}}function o(e){var r=t.getNodeData("/");for(var i in r)if(n.isDir(i)&&Object.keys(t.getNode("/"+i).diff).length>0)return!0;return!1}function u(e,t){function n(){i++,i==r.length&&(Y.lastSyncAt=new Date,e&&e.apply(this,arguments))}if(!k())return e&&e("not-connected");U.info("full "+(t?"push":"sync")+" started");var r=D(),i=0;if(r.length==0){U.info("full sync not happening. no access claimed.");return}r.forEach(function(e){c(function(){B(e,S,{pushOnly:t})},n)})}function a(e){u(e,!0)}function f(e,t,n){if(!k())return n&&n("not-connected");_(e),U.info("partial sync requested: "+e),c(function(){U.info("partial sync started from: "+e),R.once("ready",n),B(e,S,{depth:t})})}function l(e,n){if(!k())return n&&n("not-connected");_(e,!0),U.info("single sync requested: "+e),c(function(){U.info("single sync started: "+e),C(e,function(r){var i=x(e);S(e,i,r),n&&n(null,t.getNode(e),t.getNodeData(e))})})}function c(e,t){W?($=t,e()):V.push({run:e,finalizer:t})}function h(){W=!1,R.emit("state","busy"),R.emit("busy")}function p(){W=!0,X.length>0?I.apply(this,X.shift()):(R.emit("state","connected"),R.emit("ready"))}function d(){W&&X.length==0&&R.emit("ready")}function v(){return W?"connected":"busy"}function m(e,t,n,r){R.emit("conflict",{type:e,path:t,localValue:n.data,remoteValue:r.data,localTime:new Date(n.timestamp),remoteTime:new Date(r.timestamp),lastUpdate:new Date(n.lastUpdatedAt),resolve:j(t,n,r)})}function g(e,t){var n={path:e};if(typeof t=="object")n.stack=t.stack,typeof (n.stack=="string")&&(n.stack=n.stack.split("\n")),n.message=t.message,n.exception=t;else{if(t=="timeout"){R.emit("timeout");return}n.message=t}R.emit("error",n)}function y(e,n,r){U.info("DELETE",e,"REMOTE -> LOCAL");var i=t.getNodeData(e);t.removeNode(e,r.timestamp)}function b(r,i,s){U.info("DELETE",r,"LOCAL -> REMOTE"),e.remove(r,F(r,n.curry(t.clearDiff,r,undefined)))}function w(e,n,r){U.info("UPDATE",e,"REMOTE -> LOCAL"),t.setNodeData(e,r.data,!1,r.timestamp,r.mimeType)}function E(r,i,s){U.info("UPDATE",r,"LOCAL -> REMOTE"),e.set(r,i.data,i.mimeType,F(r,function(){T(n.containingDir(r),function(e){t.clearDiff(r,e[n.baseName(r)])})}))}function S(e,t,r){var i=null;if(t.deleted)U.debug(e,"outgoing delete"),i=b;else if(r.deleted&&t.lastUpdatedAt>0)t.timestamp==t.lastUpdatedAt?(U.debug(e,"incoming delete"),i=y):(U.debug(e,"deletion conflict","remote",r,"local",t),i=n.curry(m,"delete"));else{if(t.timestamp==r.timestamp){U.debug(e,"no action today");return}t.timestamp>r.timestamp?t.lastUpdatedAt==r.timestamp?(U.debug(e,"outgoing update"),i=E):(U.debug(e,"merge conflict (local > remote)","remote",r,"local",t),i=n.curry(m,"merge")):t.timestamp<r.timestamp&&(t.lastUpdatedAt==t.timestamp?(U.debug(e,"incoming update"),i=w):(U.debug(e,"merge conflict (local < remote)","remote",r,"local",t),i=n.curry(m,"merge")))}if(!i){var s=new Error("Something went terribly wrong.");throw s.path=e,s.localNode=t,s.remoteNode=r,s}i(e,t,r)}function x(e,r){U.info("fetch local",e);var i=t.getNode(e);i.data=t.getNodeData(e),O(e)&&(r=!1);if(typeof r=="undefined"){var s=n.containingDir(e);if(s){var o=n.baseName(e),u=t.getNode(s),a=t.getNodeData(s);r=!a[o]&&u.diff[o]}else r=!1}return i.deleted=r,i}function T(t,n){U.info("fetch remote",t),e.get(t,function(e,r,i){if(e)g(t,e);else try{n(r,i)}catch(s){g(t,s)}})}function N(e,t,n){return{timestamp:n,data:e,deleted:n==0,mimeType:t}}function C(e,t,r){function i(i,o){r(N(i,o,t&&t[n.baseName(e)]||(s?(new Date).getTime():0)))}var s=O(e);if(r)T(e,i);else{r=t,t=null;var o=n.containingDir(e);s?T(e,i):o?T(o,function(n){t=n,T(e,i)}):T(e,i)}}function k(){return e.getState()=="connected"}function L(e,t){var n={};for(var r=0;r<e.length;r++)n[e[r]]=!0;for(var i=0;i<t.length;i++)n[t[i]]=!0;return Object.keys(n)}function A(e){return K.test(e)}function O(e){return J.test(e)}function M(e,t){return A(e)||(t?O(e):!1)}function _(e,t){if(!M(e,t))throw new Error("Invalid path: "+e)}function D(e){var n=t.getNode("/"),r=[];return n.startAccess?r.push("/"):Object.keys(t.getNodeData("/")).forEach(function(e){t.getNode("/"+e).startAccess&&r.push("/"+e)}),r}function P(e){if(!e)return null;var r=t.getNode(e);return r.startAccess?r.startAccess:P(n.containingDir(e))}function H(e){var r=[],i=t.getNodeData(e);for(var s in i){var o=t.getNode(e+s);o.startForce||o.startForceTree?r.push(e+s):n.isDir(s)&&H(e+s).forEach(function(e){r.push(e)})}return U.debug("findNextForceRoots",e,JSON.stringify(r)),r}function B(e,r,i){U.info("traverse",e,i,"callback?",!!r);if(!n.isDir(e))throw"Can't traverse data node: "+e;i||(i={});var s=i.done||function(){};(i.depth||i.depth==0)&&U.debug("traverse depth",i.depth,e);var o=t.getNode(e),u=t.getNodeData(e);u||(u={},t.setNodeData(e,u,!1,0,"application/json")),i.access=n.highestAccess(i.access,o.startAccess),i.force=i.force||o.startForce,i.forceTree=i.forceTree||o.startForceTree,i.access||(i.access=P(n.containingDir(e)));if(!i.force&&!i.forceTree){U.debug("skipping",e,"no interest","(access: ",i.access," force: ",i.force," forceTree: ",i.forceTree,")");if(i.access||e=="/"){var a=H(e);if(a.length>0){var f;while(f=a.shift()){var l=n.pathParts(e),c=n.pathParts(f),h=n.extend({},i);h.done=s,h.depth=i.depth?c.length-l.length:null,(h.depth==null||h.depth>0)&&B(f,r,h)}return}}d(),s();return}var p=Object.keys(o.diff).length>0;if(!p&&i.pushOnly){d(),s();return}T(e,function(a){a||(a={}),s();var f=L(Object.keys(a),Object.keys(u));i.forceTree&&!i.force&&Object.keys(u).length==0&&(f.forEach(function(e){u[e]=0}),t.setNodeData(e,u,!1,0,"application/json"));if(!p){var l=!1;for(var c=0;c<f.length;c++){var h=f[c];if(u[h]!=a[h]){l=!0;break}}if(!l){U.debug("skipping",e,"no changes"),d(),s();return}}I(f,6,function(t,s){var f=e+t;if(n.isDir(t))if(i.depth&&i.depth==1)s();else{var l=n.extend({},i);l.depth&&l.depth--,l.done=s,B(f,r,l)}else i.force?C(f,a,function(e){var n=x(f,!u[t]&&o.diff[t]);r(f,n,e),s()}):s()})})}function j(e,t,n){return function(r,i){if(r=="local")i&&(t.data=i,w(e,t,t)),E(e,t,n);else{if(r!="remote")throw"Invalid conflict resolution: "+r;w(e,t,n)}}}function F(e,t){return function(n){if(n)g(e,n);else if(t){var r=Array.prototype.slice.call(arguments,1);t.apply(this,r)}}}function I(e,t,n){function r(){o++,n(e[u++],i)}function i(){o--,u==e.length&&o==0?p():u<e.length&&s()}function s(){while(o<t&&u<e.length)r()}if(!W){X.push([e,t,n]);return}h();var o=0,u=0;setTimeout(s,1)}function q(e,t,n){return function(){var s=Array.prototype.slice.call(arguments),o=s.slice(-1)[0],u=s;typeof o=="function"?u=s.slice(0,-1):o=null;var a=(new Date).getTime(),f=[e,u],l=r("limitCache")||{};l[f]&&l[f]>a-n?(U.debug("limit",e,"-> replay"),o&&o()):(U.debug("limit",e,"-> call through"),l[f]=a,i("limitCache",l),t.apply(this,s))}}var R=n.getEventEmitter("error","conflict","state","busy","ready","timeout"),U=n.getLogger("sync"),z="remote_storage_sync:",W=!0,X=[],V=[],$=null;R.on("ready",function(){U.info("READY","queued tasks: ",V.length),$&&($(),$=null);if(V.length>0){var e=V.shift();$=e.finalizer,e.run()}});var J=/^[^\/][^:]+:\//,K=/^\//;R.on("error",function(e){U.error("Error: ",e)});var Q=q("fullSync",u,3e4),G=q("partialSync",f,3e4),Y={lastSyncAt:null,fullSync:Q,forceSync:u,fullPush:a,partialSync:G,syncOne:l,needsSync:o,getState:v,on:R.on,clearSettings:s,syncNow:function(e,t){n.deprecate("sync.syncNow","sync.fullSync"),this.fullSync(t)},fetchNow:function(e,t){n.deprecate("sync.fetchNow","sync.syncOne or sync.partialSync"),this.syncOne(e,t)},disableThrottling:function(){Y.fullSync=u,Y.partialSync=f}};return Y}),n("lib/schedule",["./util","./sync"],function(e,t){function n(){f=setTimeout(r,u)}function r(){if(!a)return;f&&clearTimeout(f),i.info("check");var e=[],r=0,u=(new Date).getTime();for(var l in s){var c=o[l];(!c||c+s[l]<=u)&&e.push(l)}if(e.length==0){n();return}i.info("Paths to refresh: ",e);for(var h=0;h<e.length;h++){var l=e[h],p=function(e,n){e=="/"?t.fullSync(n):t.partialSync(e,null,n)};p(l,function(){o[l]=(new Date).getTime(),r++,r==e.length&&n()})}}var i=e.getLogger("schedule"),s={},o={},u=3e4,a=!1,f=null;return{enable:function(){a=!0,i.info("enabled"),n()},disable:function(){a=!1,i.info("disabled")},watch:function(e,t){s[e]=t,o[e]||(o[e]=(new Date).getTime())},unwatch:function(e){delete s[e],delete o[e]}}}),n("lib/mailcheck",[],function(){var e={mailcheck:{threshold:3,defaultDomains:["5apps.com","heahdk.net"],defaultTopLevelDomains:["co.uk","com","net","org","info","edu","gov","mil"],run:function(t){t.domains=t.domains||e.mailcheck.defaultDomains,t.topLevelDomains=t.topLevelDomains||e.mailcheck.defaultTopLevelDomains,t.distanceFunction=t.distanceFunction||e.sift3Distance;var n=e.mailcheck.suggest(encodeURI(t.email),t.domains,t.topLevelDomains,t.distanceFunction);n?t.suggested&&t.suggested(n):t.empty&&t.empty()},suggest:function(e,t,n,r){e=e.toLowerCase();var i=this.splitEmail(e),s=this.findClosestDomain(i.domain,t,r);if(s){if(s!=i.domain)return{address:i.address,domain:s,full:i.address+"@"+s}}else{var o=this.findClosestDomain(i.topLevelDomain,n);if(i.domain&&o&&o!=i.topLevelDomain){var u=i.domain;return s=u.substring(0,u.lastIndexOf(i.topLevelDomain))+o,{address:i.address,domain:s,full:i.address+"@"+s}}}return!1},findClosestDomain:function(e,t,n){var r,i=99,s=null;if(!e||!t)return!1;n||(n=this.sift3Distance);for(var o=0;o<t.length;o++){if(e===t[o])return e;r=n(e,t[o]),r<i&&(i=r,s=t[o])}return i<=this.threshold&&s!==null?s:!1},sift3Distance:function(e,t){if(e==null||e.length===0)return t==null||t.length===0?0:t.length;if(t==null||t.length===0)return e.length;var n=0,r=0,i=0,s=0,o=5;while(n+r<e.length&&n+i<t.length){if(e.charAt(n+r)==t.charAt(n+i))s++;else{r=0,i=0;for(var u=0;u<o;u++){if(n+u<e.length&&e.charAt(n+u)==t.charAt(n)){r=u;break}if(n+u<t.length&&e.charAt(n)==t.charAt(n+u)){i=u;break}}}n++}return(e.length+t.length)/2-s},splitEmail:function(e){var t=e.split("@");if(t.length<2)return!1;for(var n=0;n<t.length;n++)if(t[n]==="")return!1;var r=t.pop(),i=r.split("."),s="";if(i.length==0)return!1;if(i.length==1)s=i[0];else{for(var n=1;n<i.length;n++)s+=i[n]+".";i.length>=2&&(s=s.substring(0,s.length-1))}return{topLevelDomain:s,domain:r,address:t.join("@")}}}};return e}),n("lib/levenshtein",[],function(){function e(e,t){var n=[],r=e.length,s=t.length;for(i=0;i<=r;i++)n[i]=n[i]?n[i]:[],n[i][0]=i;for(j=0;j<=s;j++)n[0][j]=n[0][j]?n[0][j]:[],n[0][j]=j;for(j=1;j<=s;j++)for(i=1;i<=r;i++)e[i-1]==t[j-1]?n[i][j]=n[i-1][j-1]:n[i][j]=Math.min(n[i-1][j]+1,n[i][j-1]+1,n[i-1][j-1]+2);return n[r][s]}return e}),n("lib/widget",["./assets","./webfinger","./hardcoded","./wireClient","./sync","./store","./platform","./util","./schedule","./mailcheck","./levenshtein"],function(e,t,n,r,i,s,o,u,a,f,l){function c(e){return e}function h(){var e=r.getState();return e=="connected"?i.getState():e}function p(){d(h())}function d(e,t){z=e,t!==!1&&w(e,W),e=="offline"&&a.disable(),Y.emit("state",e)}function v(){return z}function m(){function t(e,t,n){var r=document.createElement(e);t&&r.setAttribute("id",t),n&&n._content&&(r.innerHTML=n._content,delete n._content);for(var i in n)r.setAttribute(i,n[i]);return r}var n={root:t("div","remotestorage-state"),connectButton:t("input","remotestorage-connect-button",{"class":"remotestorage-button",type:"submit",value:c("connect")}),registerButton:t("span","remotestorage-register-button",{"class":"remotestorage-button",_content:c("get remotestorage")}),cube:t("img","remotestorage-cube",{src:e.remoteStorageCube}),bubble:t("span","remotestorage-bubble"),helpHint:t("a","remotestorage-questionmark",{href:"http://remotestorage.io",target:"_blank",_content:"?"}),helpText:t("span","remotestorage-infotext",{"class":"infotext",_content:"This app allows you to use your own data storage!<br/>Click for more info on remotestorage."}),userAddress:t("input","remotestorage-useraddress",{placeholder:"user@host",type:"email"}),style:t("style"),menu:t("div","remotestorage-menu"),menuItemSync:t("div",null,{"class":"item",_content:"foobar"}),syncButton:t("button","remotestorage-sync-button",{_content:"Sync now","class":"remotestoage-button"})};return n.root.appendChild(n.connectButton),n.root.appendChild(n.registerButton),n.root.appendChild(n.cube),n.root.appendChild(n.bubble),n.root.appendChild(n.helpHint),n.root.appendChild(n.helpText),n.root.appendChild(n.userAddress),n.root.appendChild(n.menu),n.menu.appendChild(n.menuItemSync),n.style.innerHTML=e.widgetCss,n}function g(){(z=="connected"||z=="busy")&&i.fullSync()}function y(){if(z=="connected"||z=="busy")if(Q.menu.style.display!="block"){Q.menu.style.display="block";if(z=="busy")Q.menuItemSync.innerHTML="Syncing";else if(i.needsSync())Q.menuItemSync.innerHTML="Unsynced";else{var e=(new Date).getTime()-i.lastSyncAt.getTime();Q.menuItemSync.innerHTML="Synced "+Math.round(e/1e3)+" seconds ago"}Q.menuItemSync.appendChild(Q.syncButton)}}function b(){Q.menu.style.display="none"}function w(e,t){if(e==="authing")return o.alert("Authentication was aborted. Please try again."),d("typing");if(!Q){var n=document.getElementById(U);Q=m(),Q.registerButton.addEventListener("click",E),Q.connectButton.addEventListener("click",O),Q.bubble.addEventListener("click",M),Q.cube.addEventListener("click",_),Q.userAddress.addEventListener("keyup",P),Q.syncButton.addEventListener("click",g),Q.root.addEventListener("mouseover",y),Q.root.addEventListener("mouseout",b),n.appendChild(Q.style),n.appendChild(Q.root)}b(),Q.root.setAttribute("class",e);var t=localStorage.remote_storage_widget_useraddress||"";t?(Q.userAddress.value=t,t="<strong>"+t+"</strong>"):t="<strong>(n/a)</strong>";var r="",i=!1;$&&e!="offline"?(r="Connecting "+t,i=!0):e=="connected"?r="Disconnect "+t:e=="busy"?r="Synchronizing "+t+"...":e=="offline"&&(G=="unauthorized"?(r="Access denied by remotestorage. Click to reconnect.",i=!0):(r="Offline ("+t+")",i=!0)),Q.bubble.innerHTML=r,i?(Q.cube.setAttribute("style","opacity:1"),Q.bubble.setAttribute("style","display:inline")):(Q.cube.removeAttribute("style"),Q.bubble.removeAttribute("style")),e==="typing"&&Q.userAddress.focus()}function E(){window.open("http://unhosted.org/en/a/register.html","Get your remote storage",Z)}function S(e){if(e.substring(0,"http://".length)=="http://")e=e.substring("http://".length);else{if(e.substring(0,"https://".length)!="https://")return e;e=e.substring("https://".length)}var t=e.split("/")[0].split("@");return t.length>2?e:(t.length==2&&t.shift(),t[0])}function x(){V=window.open(document.location,"remotestorageAuthPopup",Z+",dependent=yes"),window.remotestorageTokenReceived=function(){delete window.remotestorageTokenReceived,p()}}function T(){V.close()}function N(e){V.document.location=e}function C(){if(!frames.opener)return;frames.opener.remotestorageTokenReceived(),window.close()}function k(){var e=localStorage.remote_storage_widget_auth_endpoint,t=e.split("?"),n=[];t.length==2?n=t[1].split("&"):t.length>2&&errorHandler("more than one questionmark in auth-endpoint - ignoring");var r=o.getLocation(),i=[];for(var s in J)i.push(s+":"+J[s]);n.push("response_type=token"),n.push("scope="+encodeURIComponent(i.join(" "))),n.push("redirect_uri="+encodeURIComponent(r)),n.push("client_id="+encodeURIComponent(S(r)));var u=t[0]+"?"+n.join("&");if(typeof X=="function")X(u);else switch(X){case"redirect":o.setLocation(u);break;case"popup":N(u);break;default:throw"Invalid strategy for auth dialog: "+X}}function L(e,i){t.getStorageInfo(e,{timeout:5e3},function(t,s){t?n.guessStorageInfo(e,{timeout:5e3},function(e,n){e?(et.debug("Error from fakefinger: "+e),i(t)):n.type&&n.href&&s.properties&&s.properties["auth-endpoint"]?(r.setStorageInfo(n.type,n.href),i(null,n.properties["auth-endpoint"])):i("cannot make sense of storageInfo from webfinger")}):s.type&&s.href&&s.properties&&s.properties["auth-endpoint"]?(r.setStorageInfo(s.type,s.href),i(null,s.properties["auth-endpoint"])):i("cannot make sense of storageInfo from hardcoded")})}function A(e,t){typeof t=="undefined"&&(t=0),L(e,function(n,r){n?(n=="timeout"&&t!=tt?A(e,t+1):o.alert("webfinger discovery failed! Please check if your user address is correct and try again. If the problem persists, contact your storage provider for support. (Error is: "+n+")"),X=="popup"&&T(),d("typing")):(localStorage.remote_storage_widget_auth_endpoint=r,k())})}function O(){z=="typing"?(W=Q.userAddress.value,localStorage.remote_storage_widget_useraddress=W,d("connecting"),X=="popup"&&x(),A(W)):(d("typing"),D())}function M(){z=="connected"||z=="busy"?i.fullPush(function(){r.disconnectRemote(),s.forgetAll(),i.clearSettings(),localStorage.removeItem("remote_storage_widget_useraddress"),Q.userAddress.value="",d("disconnected",!0),d("anonymous")}):z=="offline"&&G=="unauthorized"?k():z=="offline"&&G=="timeout"&&j()}function _(){(z=="connected"||z=="connected")&&M()}function D(){Q.userAddress.value.length>0?Q.connectButton.removeAttribute("disabled"):Q.connectButton.setAttribute("disabled","disabled")}function P(e){e.keyCode===13?Q.connectButton.click():D()}function H(){et.debug("handleWidgetHover")}function B(){et.info("NOW CONNECTED"),d("connected"),$=!0,s.fireInitialEvents(),i.forceSync(function(){et.info("Initial sync done."),$=!1,d(v()),a.enable(),Y.emit("ready")})}function j(){var e=K;i.fullSync(function(){K==e&&(K=0,d("connected"),a.enable())})}function F(e){setTimeout(j,e)}function I(e,t){var n=o.harvestParam("access_token"),s=o.harvestParam("storage_root"),u=o.harvestParam("storage_api"),f=o.harvestParam("authorize_endpoint");t||(t={}),a.watch("/",6e4),i.on("error",function(e){e.message=="unauthorized"&&(G="unauthorized",r.setBearerToken(null),$&&($=!1,Y.emit("ready")),d("offline"))}),i.on("timeout",function(){G="timeout",d("offline"),K++,F(Math.max(K*1e4,3e5))}),U=e,r.calcState()=="connected"?B():r.on("connected",B),r.on("error",function(e){o.alert(c(e))}),i.on("state",d),typeof t.authDialog!="undefined"&&(X=t.authDialog),R=t.locale,n&&(r.setBearerToken(n),X==="popup"&&C()),s&&r.setStorageInfo(u?u:"2012.04",s),f&&(localStorage.remote_storage_widget_auth_endpoint=f,k()),p(),t.syncShortcut!==!1&&window.addEventListener("keydown",function(e){if(e.ctrlKey&&e.which==83)return e.preventDefault(),i.fullSync(),!1}),window.addEventListener("beforeunload",function(e){if(z!="anonymous"&&z!="authing"&&z!="connecting"&&i.needsSync()){i.fullPush();var t="Synchronizing your data now. Please wait until the cube stops spinning.";return e.returnValue=t,t}})}function q(e,t){if(!J[e]||t=="rw")J[e]=t}var R="en",U,z,W,X="redirect",V,$,J={},K=0,Q,G,Y=u.getEventEmitter("state","ready"),Z="resizable,toolbar=yes,location=yes,scrollbars=yes,menubar=yes,width=820,height=800,top=0,left=0",et=u.getLogger("widget"),tt=2;return{display:I,addScope:q,getState:v,on:Y.on}}),n("lib/nodeConnect",["./wireClient","./webfinger"],function(e,t){return{setUserAddress:function(n,r){t.getStorageInfo(n,{timeout:3e3},function(t,i){t?console.error("Failed to look up storage info for user "+n+": ",t):e.setStorageInfo(i.type,i.href),r(t)})},setStorageInfo:e.setStorageInfo,setBearerToken:e.setBearerToken}}),n("lib/validate",[],function(){function e(t,n){return e(t,n,{changing:!1})}var t=e;t.Integer={type:"integer"};var n={String:String,Boolean:Boolean,Number:Number,Object:Object,Array:Array,Date:Date};t.validate=e,t.checkPropertyChange=function(t,n,r){return e(t,n,{changing:r||"property"})};var e=t._validate=function(e,t,r){function i(e){return e.type||n[e.name]==e&&e.name.toLowerCase()}function s(e,t,n,f){function l(e){a.push({property:n,message:e})}function c(e,t){if(e){if(!(typeof e!="string"||e=="any"||(e=="null"?t===null:typeof t==e)||t instanceof Array&&e=="array"||t instanceof Date&&e=="date"||e=="integer"&&t%1===0))return[{property:n,message:typeof t+" value found, but a "+e+" is required"}];if(e instanceof Array){var r=[];for(var i=0;i<e.length;i++)if(!(r=c(e[i],t)).length)break;if(r.length)return r}else if(typeof e=="object"){var o=a;a=[],s(t,e,n);var u=a;return a=o,u}}return[]}var h;n+=n?typeof f=="number"?"["+f+"]":typeof f=="undefined"?"":"."+f:f;if((typeof t!="object"||t instanceof Array)&&(n||typeof t!="function")&&(!t||!i(t)))return typeof t=="function"?e instanceof t||l("is not an instance of the class/constructor "+t.name):t&&l("Invalid schema/property definition "+t),null;u&&t.readonly&&l("is a readonly field, it can not be changed"),t["extends"]&&s(e,t["extends"],n,f);if(e===undefined)t.required&&l("is missing and it is required");else{a=a.concat(c(i(t),e)),t.disallow&&!c(t.disallow,e).length&&l(" disallowed value was matched");if(e!==null){if(e instanceof Array){if(t.items){var p=t.items instanceof Array,d=t.items;for(f=0,h=e.length;f<h;f+=1)p&&(d=t.items[f]),r.coerce&&(e[f]=r.coerce(e[f],d)),a.concat(s(e[f],d,n,f))}t.minItems&&e.length<t.minItems&&l("There must be a minimum of "+t.minItems+" in the array"),t.maxItems&&e.length>t.maxItems&&l("There must be a maximum of "+t.maxItems+" in the array")}else(t.properties||t.additionalProperties)&&a.concat(o(e,t.properties,n,t.additionalProperties));t.pattern&&typeof e=="string"&&!e.match(t.pattern)&&l("does not match the regex pattern "+t.pattern),t.maxLength&&typeof e=="string"&&e.length>t.maxLength&&l("may only be "+t.maxLength+" characters long"),t.minLength&&typeof e=="string"&&e.length<t.minLength&&l("must be at least "+t.minLength+" characters long"),typeof t.minimum!==undefined&&typeof e==typeof t.minimum&&t.minimum>e&&l("must have a minimum value of "+t.minimum),typeof t.maximum!==undefined&&typeof e==typeof t.maximum&&t.maximum<e&&l("must have a maximum value of "+t.maximum);if(t["enum"]){var v=t["enum"];h=v.length;var m;for(var g=0;g<h;g++)if(v[g]===e){m=1;break}m||l("does not have a value in the enumeration "+v.join(", "))}typeof t.maxDecimal=="number"&&e.toString().match(new RegExp("\\.[0-9]{"+(t.maxDecimal+1)+",}"))&&l("may only have "+t.maxDecimal+" digits of decimal places")}}return null}function o(e,t,n,i){if(typeof t=="object"){(typeof e!="object"||e instanceof Array)&&a.push({property:n,message:"an object is required"});for(var o in t)if(t.hasOwnProperty(o)){var f=e[o];if(f===undefined&&r.existingOnly)continue;var l=t[o];f===undefined&&l["default"]&&(f=e[o]=l["default"]),r.coerce&&o in e&&(f=e[o]=r.coerce(f,l)),s(f,l,n,o)}}for(o in e){if(e.hasOwnProperty(o)&&(o.charAt(0)!="_"||o.charAt(1)!="_")&&t&&!t[o]&&i===!1){if(r.filter){delete e[o];continue}a.push({property:n,message:typeof f+"The property "+o+" is not defined in the schema and the schema does not allow additional properties"})}var c=t&&t[o]&&t[o].requires;c&&!(c in e)&&a.push({property:n,message:"the presence of the property "+o+" requires that "+c+" also be present"}),f=e[o],i&&(!t||typeof t!="object"||!(o in t))&&(r.coerce&&(f=e[o]=r.coerce(f,i)),s(f,i,n,o)),!u&&f&&f.$schema&&(a=a.concat(s(f,f.$schema,n,o)))}return a}r||(r={});var u=r.changing,a=[];return t&&s(e,t,"",u||""),!u&&e&&e.$schema&&s(e,e.$schema,"",""),{valid:!a.length,errors:a}};return t.mustBeValid=function(e){if(!e.valid)throw new TypeError(e.errors.map(function(e){return"for property "+e.property+": "+e.message}).join(", \n"))},t}),n("lib/baseClient",["./sync","./store","./util","./validate"],function(e,t,n,r){function i(e){if(e&&typeof e=="string"){var t=e.split("/");if(t.length>3&&t[1]=="public")return t[2];if(t.length>2)return t[1]}}function s(e,t,n){var r=l.test(n.path),i;f[t]&&(i=f[t][r])&&(t!=="root"&&n.path&&(n.relativePath=n.path.replace((r?"/public/":"/")+t+"/","")),i.emit(e,n))}function o(e,t){var n=l.test(e),r=i(e);f[r][n].emit("error",t)}function u(e,r,u){var a=i(r);if(n.isDir(r)){o(r,"attempt to set a value to a directory "+r);return}var f={origin:"window",oldValue:t.getNodeData(r),newValue:u,path:r};t.setNodeData(r,u,!0),s("change",a,f),s("change","root",f)}var a=n.getLogger("baseClient"),f={},l=/^\/public\//;t.on("change",function(e){var t=i(e.path);s("change",t,e),s("change","root",e)}),e.on("conflict",function(e){var t=i(e.path);s("conflict",t,e),s("conflict","root",e)});var c=function(e,t){this.moduleName=e,this.isPublic=t,f[e]||(f[e]={}),this.events=n.getEventEmitter("change","conflict","error"),f[e][t]=this.events,n.bindAll(this)};return c.prototype={makePath:function(e){var t=this.moduleName=="root"?e[0]==="/"?"":"/":"/"+this.moduleName+"/";return(this.isPublic?"/public"+t:t)+e},nodeGivesAccess:function(e,n){var r=t.getNode(e),i=(new RegExp(n)).test(r.startAccess);if(i)return!0;if(e.length>0)return this.nodeGivesAccess(e.replace(/[^\/]+\/?$/,""))},ensureAccess:function(e){var t=this.makePath(this.moduleName=="root"?"/":"");if(!this.nodeGivesAccess(t,e))throw"Not sufficient access claimed for node at "+t},lastUpdateOf:function(e){var n=this.makePath(e),r=t.getNode(n);return r?r.timestamp:null},on:function(e,t,r){this.events.on(e,n.bind(t,r))},getObject:function(r,i,s){this.ensureAccess("r");var o=this.makePath(r),u=t.getNodeData(o);if(!i)return u;var a=n.bind(i,s);!u||typeof u=="object"&&Object.keys(u).length==0?e.syncOne(o,function(e,t){a(t)}):a(u)},getListing:function(r,i,s){this.ensureAccess("r");var o=this.makePath(r);if(!i){var u=t.getNode(o),a=t.getNodeData(o),f=[];for(var l in a)f.push(l);return f}e.fetchNow(o,function(e,r){var u=t.getNodeData(o),a=[];for(var f in u)a.push(f);n.bind(i,s)(a)})},getAll:function(e,t,r,i){typeof t!="string"&&(t=e,r=t,i=r,e=null);var s=function(n){var r={};return n.forEach(function(n){var i=this.getObject(t+n);if(!e||e==i["@type"].split("/").slice(-1)[0])r[t+n]=i},this),r}.bind(this);if(!r)return s(this.getListing(t));this.getListing(t,function(e){n.bind(r,i)(s(e))},this)},getDocument:function(r,i,s){function o(){var e=t.getNode(u);return e?{mimeType:e.mimeType,data:t.getNodeData(u)}:null}this.ensureAccess("r");var u=this.makePath(r),a=o();if(!i)return a;var f=n.bind(i,s);a?f(a):e.syncOne(u,function(){f(o())})},remove:function(t,r,i){this.ensureAccess("w");var s=this.makePath(t);u(t,s,undefined),e.syncOne(s,n.bind(r,i))},storeObject:function(t,r,i,s,o){this.ensureAccess("w");if(typeof i!="object")throw"storeObject needs to get an object as value!";i["@type"]=this.resolveType(t);var a=this.validateObject(i);if(a)return console.error("Error saving this ",t,": ",i,a),a;var f=this.makePath(r);return u(r,f,i,"application/json"),e.syncOne(f,n.bind(s,o)),null},storeDocument:function(t,r,i,s,o){this.ensureAccess("w");var a=this.makePath(r);u(r,a,i,t),e.syncOne(a,n.bind(s,o))},getStorageHref:function(){return remoteStorage.getStorageHref()},getItemURL:function(e){var t=this.getStorageHref();return t?(t.substr(-1)!="/"&&(t+="/"),t+this.makePath(e)):null},syncOnce:function(n,r){var i=t.getNode(n).startForceTree;this.use(n,!1),e.partialSync(n,1,function(){i?this.use(n,!0):this.release(n),r&&r()}.bind(this))},use:function(e,n){var r=this.makePath(e);t.setNodeForce(r,!n,!0)},release:function(e){var n=this.makePath(e);t.setNodeForce(n,!1,!1)},hasDiff:function(e){var r=this.makePath(e);if(n.isDir(r))return Object.keys(t.getNode(r).diff).length>0;var i=n.containingDir(r);return!!t.getNode(i).diff[e.split("/").slice(-1)[0]]},types:{},schemas:{},resolveType:function(e){var t=this.types[e];return t||(t="https://remotestoragejs.com/spec/modules/"+this.moduleName+"/"+e,a.error("WARNING: type alias not declared: "+e,"(have:",this.types,this.schemas,")")),t},resolveSchema:function(e){var t=this.schemas[e];return t||(t={},a.error("WARNING: can't find schema for type: ",e)),t},declareType:function(e,t,n){this.types[e]&&a.error("WARNING: re-declaring already declared alias "+e),n||(n=t,t="https://remotestoragejs.com/spec/modules/"+this.moduleName+"/"+e);if(n["extends"]){var r=this.types[n["extends"]];if(!r){a.error("Type '"+e+"' tries to extend unknown schema '"+n["extends"]+"'");return}n["extends"]=this.schemas[r]}this.types[e]=t,this.schemas[t]=n},validateObject:function(e,t){var n=e["@type"];if(!n){if(!t)return[{property:"@type",message:"missing"}];n=this.resolveType(t)}var i=this.resolveSchema(n),s=r(e,i);return s.valid?null:s.errors}},c}),n("lib/foreignClient",["./util","./baseClient","./getputdelete","./store"],function(e,t,n,r){var i=e.getLogger("foreignClient"),s={};r.on("foreign-change",function(e){var t=e.path.split(":")[0],n=s[t];n&&n.events.emit("change",e)});var o=function(t){this.userAddress=t,this.pathPrefix=t+":",this.moduleName="root",this.isPublic=!0,this.events=e.getEventEmitter("change","error"),s[t]=this,e.bindAll(this)};o.prototype={getPublished:function(e,t){var n;typeof e=="function"?(t=e,n="/publishedItems"):n="/"+e+"/publishedItems",this.getObject(n,function(e){e&&delete e["@type"],t(e||{})})},getPublishedObjects:function(e,t){this.getPublished(e,function(n){function r(){if(s<i.length){var n=i[s++],u="/"+e+"/"+n;this.getObject(u,function(e){o[u]=e,r.call(this)}.bind(this))}else t(o)}var i=Object.keys(n),s=0,o={};r.call(this)}.bind(this))},makePath:function(e){return this.pathPrefix+t.prototype.makePath.call(this,e)},nodeGivesAccess:function(e,t){return t=="r"},on:function(e,t){this.events.on(e,t)}};var u={makePath:!0,getListing:!0,getAll:!0,storeDocument:!0,storeObject:!0,remove:!0,nodeGivesAccess:!0,fetchNow:!0,syncNow:!0,on:!0};for(var a in t.prototype)u[a]||(o.prototype[a]=t.prototype[a]);return{getClient:function(e){var t=s[e];return t||new o(e)}}}),n("remoteStorage",["require","./lib/widget","./lib/store","./lib/sync","./lib/wireClient","./lib/nodeConnect","./lib/util","./lib/webfinger","./lib/foreignClient","./lib/baseClient"],function(e,t,n,r,i,s,o,u,a,f){var l={},c={},h=/^[a-z]+$/,p=o.getLogger("base"),d={defineModule:function(e,t){if(!h.test(e))throw'Invalid moduleName: "'+e+'", only a-z lowercase allowed.';var n=t(new f(e,!1),new f(e,!0));c[e]=n,this[e]=n.exports},getModuleList:function(){return Object.keys(c)},getClaimedModuleList:function(){return Object.keys(l)},getModuleInfo:function(e){return c[e]},claimAccess:function(e,t){function n(e,t){if(!r.test(t))throw"Claimed access to module '"+e+"' but mode not correctly specified ('"+t+"')."}var r=/^rw?$/,i;typeof e=="object"?i=e:(n(e,t),i={},i[e]=t);for(var s in i){var o=i[s];n(s,o),this.claimModuleAccess(s,o)}},claimModuleAccess:function(e,r){p.debug("claimModuleAccess",e,r);if(!(e in c))throw"Module not defined: "+e;if(e in l)return;e=="root"?(e="",t.addScope("",r),n.setNodeAccess("/",r)):(t.addScope(e,r),n.setNodeAccess("/"+e+"/",r),n.setNodeAccess("/public/"+e+"/",r)),l[e]=!0},setBearerToken:function(e,t){i.setBearerToken(e)},disconnectRemote:i.disconnectRemote,flushLocal:n.forgetAll,fullSync:r.fullSync,syncNow:function(e,t,n){t||(n=t,t=null),r.partialSync(e,t,n)},displayWidget:t.display,onWidget:t.on,getWidgetState:t.getState,getSyncState:r.getState,setStorageInfo:i.setStorageInfo,getStorageHref:i.getStorageHref,disableSyncThrottling:r.disableThrottling,nodeConnect:s,util:o,getForeignClient:function(e,t){var n=a.getClient(e);i.hasStorageInfo(e)?t(null,n):u.getStorageInfo(e,{timeout:5e3},function(r,s){r?t(r):(i.addStorageInfo(e,s),t(null,n))})},getClient:function(e){return new f(e)}};return d}),remoteStorage=t("remoteStorage")})()